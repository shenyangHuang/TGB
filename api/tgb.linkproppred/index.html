
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../about/">
      
      
        <link rel="next" href="../tgb.nodeproppred/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>tgb.linkproppred - Temporal Graph Benchmark</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tgblinkproppred" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Temporal Graph Benchmark" class="md-header__button md-logo" aria-label="Temporal Graph Benchmark" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Temporal Graph Benchmark
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              tgb.linkproppred
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/Edge_data_pyg/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Temporal Graph Benchmark" class="md-nav__button md-logo" aria-label="Temporal Graph Benchmark" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Temporal Graph Benchmark
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    tgb.linkproppred
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    tgb.linkproppred
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset" class="md-nav__link">
    <span class="md-ellipsis">
      LinkPropPredDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LinkPropPredDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.edge_feat" class="md-nav__link">
    <span class="md-ellipsis">
      edge_feat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.edge_type" class="md-nav__link">
    <span class="md-ellipsis">
      edge_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.eval_metric" class="md-nav__link">
    <span class="md-ellipsis">
      eval_metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.full_data" class="md-nav__link">
    <span class="md-ellipsis">
      full_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.negative_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      negative_sampler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.node_feat" class="md-nav__link">
    <span class="md-ellipsis">
      node_feat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.node_type" class="md-nav__link">
    <span class="md-ellipsis">
      node_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.num_edges" class="md-nav__link">
    <span class="md-ellipsis">
      num_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.num_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      num_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.num_rels" class="md-nav__link">
    <span class="md-ellipsis">
      num_rels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.static_data" class="md-nav__link">
    <span class="md-ellipsis">
      static_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.test_mask" class="md-nav__link">
    <span class="md-ellipsis">
      test_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.train_mask" class="md-nav__link">
    <span class="md-ellipsis">
      train_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.val_mask" class="md-nav__link">
    <span class="md-ellipsis">
      val_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.download" class="md-nav__link">
    <span class="md-ellipsis">
      download
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.generate_processed_files" class="md-nav__link">
    <span class="md-ellipsis">
      generate_processed_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.generate_splits" class="md-nav__link">
    <span class="md-ellipsis">
      generate_splits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.load_test_ns" class="md-nav__link">
    <span class="md-ellipsis">
      load_test_ns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.load_val_ns" class="md-nav__link">
    <span class="md-ellipsis">
      load_val_ns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.pre_process" class="md-nav__link">
    <span class="md-ellipsis">
      pre_process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset.LinkPropPredDataset.preprocess_static_edges" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_static_edges
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_pyg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset" class="md-nav__link">
    <span class="md-ellipsis">
      PyGLinkPropPredDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PyGLinkPropPredDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.dst" class="md-nav__link">
    <span class="md-ellipsis">
      dst
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.edge_feat" class="md-nav__link">
    <span class="md-ellipsis">
      edge_feat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.edge_label" class="md-nav__link">
    <span class="md-ellipsis">
      edge_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.edge_type" class="md-nav__link">
    <span class="md-ellipsis">
      edge_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.eval_metric" class="md-nav__link">
    <span class="md-ellipsis">
      eval_metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.negative_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      negative_sampler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.node_feat" class="md-nav__link">
    <span class="md-ellipsis">
      node_feat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.node_type" class="md-nav__link">
    <span class="md-ellipsis">
      node_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.num_edges" class="md-nav__link">
    <span class="md-ellipsis">
      num_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.num_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      num_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.num_rels" class="md-nav__link">
    <span class="md-ellipsis">
      num_rels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.src" class="md-nav__link">
    <span class="md-ellipsis">
      src
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.static_data" class="md-nav__link">
    <span class="md-ellipsis">
      static_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.test_mask" class="md-nav__link">
    <span class="md-ellipsis">
      test_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.train_mask" class="md-nav__link">
    <span class="md-ellipsis">
      train_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.ts" class="md-nav__link">
    <span class="md-ellipsis">
      ts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.val_mask" class="md-nav__link">
    <span class="md-ellipsis">
      val_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.get_TemporalData" class="md-nav__link">
    <span class="md-ellipsis">
      get_TemporalData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.len" class="md-nav__link">
    <span class="md-ellipsis">
      len
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.load_test_ns" class="md-nav__link">
    <span class="md-ellipsis">
      load_test_ns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.load_val_ns" class="md-nav__link">
    <span class="md-ellipsis">
      load_val_ns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.process_data" class="md-nav__link">
    <span class="md-ellipsis">
      process_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.evaluate.Evaluator" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.evaluate.Evaluator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.evaluate.Evaluator.eval" class="md-nav__link">
    <span class="md-ellipsis">
      eval
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      negative_sampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_sampler.NegativeEdgeSampler" class="md-nav__link">
    <span class="md-ellipsis">
      NegativeEdgeSampler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NegativeEdgeSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_sampler.NegativeEdgeSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_sampler.NegativeEdgeSampler.load_eval_set" class="md-nav__link">
    <span class="md-ellipsis">
      load_eval_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_sampler.NegativeEdgeSampler.query_batch" class="md-nav__link">
    <span class="md-ellipsis">
      query_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_sampler.NegativeEdgeSampler.reset_eval_set" class="md-nav__link">
    <span class="md-ellipsis">
      reset_eval_set
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_generator" class="md-nav__link">
    <span class="md-ellipsis">
      negative_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_generator.NegativeEdgeGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      NegativeEdgeGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NegativeEdgeGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_generator.NegativeEdgeGenerator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_historical_edge_set" class="md-nav__link">
    <span class="md-ellipsis">
      generate_historical_edge_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_negative_samples" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_negative_samples_hist_rnd" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples_hist_rnd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_negative_samples_rnd" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples_rnd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator" class="md-nav__link">
    <span class="md-ellipsis">
      tkg_negative_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      TKGNegativeEdgeGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TKGNegativeEdgeGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_dst_dict" class="md-nav__link">
    <span class="md-ellipsis">
      generate_dst_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples_dst" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples_dst
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples_ftr" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples_ftr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples_random" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples_random
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      tkg_negative_sampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler" class="md-nav__link">
    <span class="md-ellipsis">
      TKGNegativeEdgeSampler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TKGNegativeEdgeSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler.load_eval_set" class="md-nav__link">
    <span class="md-ellipsis">
      load_eval_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler.query_batch" class="md-nav__link">
    <span class="md-ellipsis">
      query_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_generator" class="md-nav__link">
    <span class="md-ellipsis">
      thg_negative_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      THGNegativeEdgeGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="THGNegativeEdgeGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.generate_negative_samples" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.generate_negative_samples_nt" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples_nt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.generate_negative_samples_random" class="md-nav__link">
    <span class="md-ellipsis">
      generate_negative_samples_random
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.get_destinations_based_on_node_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_destinations_based_on_node_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_sampler" class="md-nav__link">
    <span class="md-ellipsis">
      thg_negative_sampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler" class="md-nav__link">
    <span class="md-ellipsis">
      THGNegativeEdgeSampler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="THGNegativeEdgeSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler.load_eval_set" class="md-nav__link">
    <span class="md-ellipsis">
      load_eval_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler.query_batch" class="md-nav__link">
    <span class="md-ellipsis">
      query_batch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tgb.nodeproppred/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tgb.nodeproppred
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tgb.utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tgb.utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/Edge_data_pyg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Access edge data in Pytorch Geometric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/Edge_data_numpy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Access edge data as numpy arrays
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="tgblinkproppred"><code>tgb.linkproppred</code></h1>


<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.dataset"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.dataset.LinkPropPredDataset" class="doc doc-heading">
            <code>LinkPropPredDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">class</span> <span class="nc">LinkPropPredDataset</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="n">root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;datasets&quot;</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">meta_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">preprocess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="p">):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dataset class for link prediction dataset. Stores meta information about each dataset such as evaluation metrics etc.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        also automatically pre-processes the dataset.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            name: name of the dataset</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            root: root directory to store the dataset folder</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            meta_dict: dictionary containing meta information about the dataset, should contain key &#39;dir_name&#39; which is the name of the dataset folder</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            preprocess: whether to pre-process the dataset</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">## original name</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># check if dataset url exist</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">DATA_URL_DICT</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">DATA_URL_DICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> url not found, download not supported yet.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="c1"># check if the evaluatioin metric are specified</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">DATA_EVAL_METRIC_DICT</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">DATA_EVAL_METRIC_DICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> default evaluation metric not found, it is not supported yet.&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">PROJ_DIR</span> <span class="o">+</span> <span class="n">root</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">if</span> <span class="n">meta_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>  <span class="c1">## replace hyphen with underline</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dir_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">}</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span> <span class="o">=</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;dir_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span> <span class="o">=</span> <span class="n">meta_dict</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="k">if</span> <span class="s2">&quot;fname&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_edgelist.csv&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-flight&quot;</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;airport_node_feat.csv&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-wikidata&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-smallpedia&quot;</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;staticfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_static_edgelist.csv&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">if</span> <span class="s2">&quot;thg&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_nodetype.csv&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;val_ns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_val_ns.pkl&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;test_ns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_test_ns.pkl&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1">#! version check</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_version_check</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1"># initialize</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_train_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_val_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_test_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="c1"># for tkg and thg</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="c1">#tkgl-wikidata and tkgl-smallpedia only</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="c1"># for thg only</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="c1"># check if the root directory exists, if not create it</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">if</span> <span class="n">osp</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset directory is &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="c1"># os.makedirs(self.root)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">if</span> <span class="n">preprocess</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pre_process</span><span class="p">()</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_dst_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dst_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tkg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">DATA_NS_STRATEGY_DICT</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span> <span class="o">=</span> <span class="n">TKGNegativeEdgeSampler</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                    <span class="n">dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                    <span class="n">first_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                    <span class="n">last_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                    <span class="n">strategy</span><span class="o">=</span><span class="n">DATA_NS_STRATEGY_DICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                    <span class="n">partial_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> negative sampling strategy not found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;thg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="c1">#* need to find the smallest node id of all nodes (regardless of types)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">min_node_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">max_node_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span> <span class="o">=</span> <span class="n">THGNegativeEdgeSampler</span><span class="p">(</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="n">dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="n">first_node_id</span><span class="o">=</span><span class="n">min_node_idx</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">last_node_id</span><span class="o">=</span><span class="n">max_node_idx</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">node_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span> <span class="o">=</span> <span class="n">NegativeEdgeSampler</span><span class="p">(</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">first_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">last_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">def</span> <span class="nf">_version_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Implement Version checks for dataset files</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        updates the file names based on the current version number</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        prompt the user to download the new version via self.version_passed variable</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">DATA_VERSION_DICT</span><span class="p">):</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">version</span> <span class="o">=</span> <span class="n">DATA_VERSION_DICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> version number not found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">version</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="c1">#* check if current version is outdated</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_edgelist_v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-flight&quot;</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;airport_node_feat_v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;val_ns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_val_ns_v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;test_ns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_test_ns_v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> version </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please download the latest version of the dataset.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        downloads this dataset from url</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        check if files are already downloaded</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="c1"># check if the file already exists</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">if</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;raw file found, skipping download&quot;</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="k">return</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">inp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="s2">&quot;Will you download the dataset(s) now? (y/N)</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># ask if the user wants to download the dataset</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">if</span> <span class="n">inp</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">WARNING</span><span class="si">}</span><span class="s2">Download started, this might take a while . . . </span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">ENDC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset title: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Dataset url not found, download not supported yet.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="c1"># download_dir = self.root + &quot;/&quot; + &quot;download&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                <span class="k">if</span> <span class="n">osp</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset directory is &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">path_download</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_download</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                    <span class="n">total_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">))</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">progress</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                        <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">),</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                        <span class="n">expected_size</span><span class="o">=</span><span class="p">(</span><span class="n">total_length</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                    <span class="p">):</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                        <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                            <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                <span class="c1"># for unzipping the file</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">path_download</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">OKGREEN</span><span class="si">}</span><span class="s2">Download completed </span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">ENDC</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="n">BColors</span><span class="o">.</span><span class="n">FAIL</span> <span class="o">+</span> <span class="s2">&quot;Data not found error, download &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; failed&quot;</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">def</span> <span class="nf">generate_processed_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        turns raw data .csv file into a pandas data frame, stored on disc if not already</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">            df: pandas data frame</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">node_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                    <span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s1">&#39;nodefile&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="c1">#* for thg must have nodetypes </span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                    <span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s1">&#39;nodeTypeFile&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">OUT_DF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="n">OUT_EDGE_FEAT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_edge&quot;</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">OUT_NODE_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_nodeid&quot;</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="n">OUT_NODE_FEAT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_node&quot;</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="n">OUT_NODE_TYPE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_nodeType&quot;</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loading processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">edge_feat</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_EDGE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-wikidata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-smallpedia&quot;</span><span class="p">):</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_NODE_ID</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="n">node_id</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="n">node_feat</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_NODE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="n">node_type</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_NODE_TYPE</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not processed, generating processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-flight&quot;</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-coin&quot;</span><span class="p">:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data_sc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-comment&quot;</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data_rc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-review&quot;</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data_sc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-wiki&quot;</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">load_edgelist_wiki</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-subreddit&quot;</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">load_edgelist_wiki</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-lastfm&quot;</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">load_edgelist_wiki</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-polecat&quot;</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_tkg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-icews&quot;</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_tkg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-yago&quot;</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_tkg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-wikidata&quot;</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_wikidata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">OUT_NODE_ID</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="n">node_ids</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-smallpedia&quot;</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_wikidata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">OUT_NODE_ID</span><span class="p">)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="n">node_ids</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-myket&quot;</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_thg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-github&quot;</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_thg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-forum&quot;</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_forum_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-software&quot;</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_thg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">edge_feat</span><span class="p">,</span> <span class="n">OUT_EDGE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="n">node_feat</span> <span class="o">=</span> <span class="n">process_node_feat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">],</span> <span class="n">node_ids</span><span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_feat</span><span class="p">,</span> <span class="n">OUT_NODE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="n">node_type</span> <span class="o">=</span> <span class="n">process_node_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">],</span> <span class="n">node_ids</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_type</span><span class="p">,</span> <span class="n">OUT_NODE_TYPE</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="c1">#? do not return node_type, simply set it</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_feat</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="k">def</span> <span class="nf">pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        Pre-process the dataset and generates the splits, must be run before dataset properties can be accessed</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        generates the edge data and different train, val, test splits</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="c1"># check if path to file is valid</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_processed_files</span><span class="p">()</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="c1">#* design choice, only stores the original edges not the inverse relations on disc</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;tkgl&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">add_inverse_quadruples</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="n">sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">])</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">destinations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">])</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">])</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">edge_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">])</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">])</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">edge_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>  <span class="c1"># should be 1 for all pos edges</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span> <span class="o">=</span> <span class="n">edge_feat</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="n">node_feat</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">full_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="n">sources</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="n">destinations</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="s2">&quot;timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="s2">&quot;edge_idxs&quot;</span><span class="p">:</span> <span class="n">edge_idxs</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="s2">&quot;edge_feat&quot;</span><span class="p">:</span> <span class="n">edge_feat</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="n">weights</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="s2">&quot;edge_label&quot;</span><span class="p">:</span> <span class="n">edge_label</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="p">}</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="c1">#* for tkg and thg</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;edge_type&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="p">):</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">edge_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="n">edge_type</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_type</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">=</span> <span class="n">full_data</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;yago&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="n">_train_mask</span><span class="p">,</span> <span class="n">_val_mask</span><span class="p">,</span> <span class="n">_test_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_splits</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">val_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">test_ratio</span><span class="o">=</span><span class="mf">0.10</span><span class="p">)</span> <span class="c1">#99) #val_ratio=0.097, test_ratio=0.099)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">_train_mask</span><span class="p">,</span> <span class="n">_val_mask</span><span class="p">,</span> <span class="n">_test_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_splits</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">val_ratio</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">test_ratio</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span> <span class="o">=</span> <span class="n">_train_mask</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span> <span class="o">=</span> <span class="n">_val_mask</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span> <span class="o">=</span> <span class="n">_test_mask</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="k">def</span> <span class="nf">generate_splits</span><span class="p">(</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">full_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">val_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="n">test_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generates train, validation, and test splits from the full dataset</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">            full_data: dictionary containing the full dataset</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            val_ratio: ratio of validation data</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">            test_ratio: ratio of test data</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">            train_data: dictionary containing the training dataset</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            val_data: dictionary containing the validation dataset</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">            test_data: dictionary containing the test dataset</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">val_time</span><span class="p">,</span> <span class="n">test_time</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                <span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">],</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="p">[(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">val_ratio</span> <span class="o">-</span> <span class="n">test_ratio</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">test_ratio</span><span class="p">)],</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">]</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="n">train_mask</span> <span class="o">=</span> <span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">val_time</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="n">val_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">test_time</span><span class="p">,</span> <span class="n">timestamps</span> <span class="o">&gt;</span> <span class="n">val_time</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="n">test_mask</span> <span class="o">=</span> <span class="n">timestamps</span> <span class="o">&gt;</span> <span class="n">test_time</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="k">return</span> <span class="n">train_mask</span><span class="p">,</span> <span class="n">val_mask</span><span class="p">,</span> <span class="n">test_mask</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="k">def</span> <span class="nf">preprocess_static_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">        Pre-process the static edges of the dataset</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;staticfile&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="n">OUT_DF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_static&quot;</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loading processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                <span class="n">static_dict</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="n">static_dict</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not processed, generating processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="n">static_dict</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span>  <span class="n">csv_to_staticdata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;staticfile&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span><span class="p">)</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="n">save_pkl</span><span class="p">(</span><span class="n">static_dict</span><span class="p">,</span> <span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="n">static_dict</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;static edges are only for tkgl-wikidata and tkgl-smallpedia datasets&quot;</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="k">def</span> <span class="nf">eval_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        the official evaluation metric for the dataset, loaded from info.py</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            eval_metric: str, the evaluation metric</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">def</span> <span class="nf">negative_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NegativeEdgeSampler</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">        Returns the negative sampler of the dataset, will load negative samples from disc</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">            negative_sampler: NegativeEdgeSampler</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="k">def</span> <span class="nf">load_val_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        load the negative samples for the validation set</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span><span class="o">.</span><span class="n">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;val_ns&quot;</span><span class="p">],</span> <span class="n">split_mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="k">def</span> <span class="nf">load_test_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        load the negative samples for the test set</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span><span class="o">.</span><span class="n">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;test_ns&quot;</span><span class="p">],</span> <span class="n">split_mode</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="k">def</span> <span class="nf">num_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        Returns the total number of unique nodes in the dataset </span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">            num_nodes: int, the number of unique nodes</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="n">dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="n">all_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">uniq_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="k">return</span> <span class="n">uniq_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="k">def</span> <span class="nf">num_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">        Returns the total number of edges in the dataset</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">            num_edges: int, the number of edges</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="k">return</span> <span class="n">src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="k">def</span> <span class="nf">num_rels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        Returns the number of relation types in the dataset</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">            num_rels: int, the number of relation types</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="c1">#* if it is a homogenous graph</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;edge_type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">):</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="k">def</span> <span class="nf">node_feat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">        Returns the node features of the dataset with dim [N, feat_dim]</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">            node_feat: np.ndarray, [N, feat_dim] or None if there is no node feature</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="k">def</span> <span class="nf">node_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        Returns the node types of the dataset with dim [N], only for temporal heterogeneous graphs</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">            node_feat: np.ndarray, [N] or None if there is no node feature</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="k">def</span> <span class="nf">edge_feat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        Returns the edge features of the dataset with dim [E, feat_dim]</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">            edge_feat: np.ndarray, [E, feat_dim] or None if there is no edge feature</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="k">def</span> <span class="nf">edge_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">        Returns the edge types of the dataset with dim [E, 1], only for temporal knowledge graph and temporal heterogeneous graph</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">            edge_type: np.ndarray, [E, 1] or None if it is not a TKG or THG</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="k">def</span> <span class="nf">static_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">        Returns the static edges related to this dataset, applies for tkgl-wikidata and tkgl-smallpedia, edges are (src, dst, rel_type)</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">            df: pd.DataFrame {&quot;head&quot;: np.ndarray, &quot;tail&quot;: np.ndarray, &quot;rel_type&quot;: np.ndarray}</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-wikidata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-smallpedia&quot;</span><span class="p">):</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_static_edges</span><span class="p">()</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="k">def</span> <span class="nf">full_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">        the full data of the dataset as a dictionary with keys: &#39;sources&#39;, &#39;destinations&#39;, &#39;timestamps&#39;, &#39;edge_idxs&#39;, &#39;edge_feat&#39;, &#39;w&#39;, &#39;edge_label&#39;,</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">            full_data: Dict[str, Any]</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                <span class="s2">&quot;dataset has not been processed yet, please call pre_process() first&quot;</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>            <span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="k">def</span> <span class="nf">train_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">        Returns the train mask of the dataset</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">            train_mask: training masks</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;training split hasn&#39;t been loaded&quot;</span><span class="p">)</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>    <span class="k">def</span> <span class="nf">val_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        Returns the validation mask of the dataset</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            val_mask: Dict[str, Any]</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;validation split hasn&#39;t been loaded&quot;</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="k">def</span> <span class="nf">test_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">        Returns the test mask of the dataset:</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">            test_mask: Dict[str, Any]</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;test split hasn&#39;t been loaded&quot;</span><span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.edge_feat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_feat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the edge features of the dataset with dim [E, feat_dim]
Returns:
    edge_feat: np.ndarray, [E, feat_dim] or None if there is no edge feature</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.edge_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the edge types of the dataset with dim [E, 1], only for temporal knowledge graph and temporal heterogeneous graph
Returns:
    edge_type: np.ndarray, [E, 1] or None if it is not a TKG or THG</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.eval_metric" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_metric</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>the official evaluation metric for the dataset, loaded from info.py
Returns:
    eval_metric: str, the evaluation metric</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.full_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">full_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>the full data of the dataset as a dictionary with keys: 'sources', 'destinations', 'timestamps', 'edge_idxs', 'edge_feat', 'w', 'edge_label',</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>full_data</code></td>            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.negative_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">negative_sampler</span><span class="p">:</span> <span class="n">NegativeEdgeSampler</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the negative sampler of the dataset, will load negative samples from disc
Returns:
    negative_sampler: NegativeEdgeSampler</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.node_feat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_feat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the node features of the dataset with dim [N, feat_dim]
Returns:
    node_feat: np.ndarray, [N, feat_dim] or None if there is no node feature</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.node_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the node types of the dataset with dim [N], only for temporal heterogeneous graphs
Returns:
    node_feat: np.ndarray, [N] or None if there is no node feature</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.num_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_edges</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the total number of edges in the dataset
Returns:
    num_edges: int, the number of edges</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.num_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_nodes</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the total number of unique nodes in the dataset 
Returns:
    num_nodes: int, the number of unique nodes</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.num_rels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_rels</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the number of relation types in the dataset
Returns:
    num_rels: int, the number of relation types</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.static_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">static_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the static edges related to this dataset, applies for tkgl-wikidata and tkgl-smallpedia, edges are (src, dst, rel_type)
Returns:
    df: pd.DataFrame {"head": np.ndarray, "tail": np.ndarray, "rel_type": np.ndarray}</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.test_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the test mask of the dataset:
Returns:
    test_mask: Dict[str, Any]</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.train_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the train mask of the dataset
Returns:
    train_mask: training masks</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.val_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">val_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the validation mask of the dataset
Returns:
    val_mask: Dict[str, Any]</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="n">meta_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preprocess</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Dataset class for link prediction dataset. Stores meta information about each dataset such as evaluation metrics etc.
also automatically pre-processes the dataset.
Args:
    name: name of the dataset
    root: root directory to store the dataset folder
    meta_dict: dictionary containing meta information about the dataset, should contain key 'dir_name' which is the name of the dataset folder
    preprocess: whether to pre-process the dataset</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;datasets&quot;</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">meta_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">preprocess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dataset class for link prediction dataset. Stores meta information about each dataset such as evaluation metrics etc.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    also automatically pre-processes the dataset.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        name: name of the dataset</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        root: root directory to store the dataset folder</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        meta_dict: dictionary containing meta information about the dataset, should contain key &#39;dir_name&#39; which is the name of the dataset folder</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        preprocess: whether to pre-process the dataset</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1">## original name</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="c1"># check if dataset url exist</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">DATA_URL_DICT</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">DATA_URL_DICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> url not found, download not supported yet.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="c1"># check if the evaluatioin metric are specified</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">DATA_EVAL_METRIC_DICT</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">DATA_EVAL_METRIC_DICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> default evaluation metric not found, it is not supported yet.&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">root</span> <span class="o">=</span> <span class="n">PROJ_DIR</span> <span class="o">+</span> <span class="n">root</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="n">meta_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>  <span class="c1">## replace hyphen with underline</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">meta_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dir_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">}</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span> <span class="o">=</span> <span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;dir_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span> <span class="o">=</span> <span class="n">meta_dict</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">if</span> <span class="s2">&quot;fname&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_edgelist.csv&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-flight&quot;</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;airport_node_feat.csv&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-wikidata&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-smallpedia&quot;</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;staticfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_static_edgelist.csv&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">if</span> <span class="s2">&quot;thg&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_nodetype.csv&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;val_ns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_val_ns.pkl&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;test_ns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_test_ns.pkl&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1">#! version check</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_version_check</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="c1"># initialize</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_train_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_val_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_test_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="c1"># for tkg and thg</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="c1">#tkgl-wikidata and tkgl-smallpedia only</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="c1"># for thg only</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># check if the root directory exists, if not create it</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="k">if</span> <span class="n">osp</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset directory is &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="c1"># os.makedirs(self.root)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">if</span> <span class="n">preprocess</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_process</span><span class="p">()</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">min_dst_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_dst_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tkg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">DATA_NS_STRATEGY_DICT</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span> <span class="o">=</span> <span class="n">TKGNegativeEdgeSampler</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="n">dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">first_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">last_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="n">strategy</span><span class="o">=</span><span class="n">DATA_NS_STRATEGY_DICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="n">partial_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> negative sampling strategy not found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;thg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="c1">#* need to find the smallest node id of all nodes (regardless of types)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">min_node_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">max_node_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span> <span class="o">=</span> <span class="n">THGNegativeEdgeSampler</span><span class="p">(</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">first_node_id</span><span class="o">=</span><span class="n">min_node_idx</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">last_node_id</span><span class="o">=</span><span class="n">max_node_idx</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">node_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span> <span class="o">=</span> <span class="n">NegativeEdgeSampler</span><span class="p">(</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">first_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">last_dst_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_dst_idx</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.download" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>downloads this dataset from url
check if files are already downloaded</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    downloads this dataset from url</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    check if files are already downloaded</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="c1"># check if the file already exists</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">if</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;raw file found, skipping download&quot;</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">return</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">inp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="s2">&quot;Will you download the dataset(s) now? (y/N)</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># ask if the user wants to download the dataset</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">if</span> <span class="n">inp</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">WARNING</span><span class="si">}</span><span class="s2">Download started, this might take a while . . . </span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">ENDC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset title: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Dataset url not found, download not supported yet.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="c1"># download_dir = self.root + &quot;/&quot; + &quot;download&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">if</span> <span class="n">osp</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset directory is &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">path_download</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_download</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="n">total_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">))</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">progress</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                    <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">),</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                    <span class="n">expected_size</span><span class="o">=</span><span class="p">(</span><span class="n">total_length</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="p">):</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                    <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="c1"># for unzipping the file</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">path_download</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">OKGREEN</span><span class="si">}</span><span class="s2">Download completed </span><span class="si">{</span><span class="n">BColors</span><span class="o">.</span><span class="n">ENDC</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">BColors</span><span class="o">.</span><span class="n">FAIL</span> <span class="o">+</span> <span class="s2">&quot;Data not found error, download &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; failed&quot;</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.generate_processed_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_processed_files</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>turns raw data .csv file into a pandas data frame, stored on disc if not already
Returns:
    df: pandas data frame</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="k">def</span> <span class="nf">generate_processed_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    turns raw data .csv file into a pandas data frame, stored on disc if not already</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        df: pandas data frame</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">node_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s1">&#39;nodefile&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="c1">#* for thg must have nodetypes </span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                <span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s1">&#39;nodeTypeFile&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">OUT_DF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">OUT_EDGE_FEAT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_edge&quot;</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">OUT_NODE_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_nodeid&quot;</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="n">OUT_NODE_FEAT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_node&quot;</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="n">OUT_NODE_TYPE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_nodeType&quot;</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loading processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">edge_feat</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_EDGE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-wikidata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-smallpedia&quot;</span><span class="p">):</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">node_id</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_NODE_ID</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="n">node_id</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="n">node_feat</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_NODE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">node_type</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_NODE_TYPE</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not processed, generating processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-flight&quot;</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-coin&quot;</span><span class="p">:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data_sc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-comment&quot;</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data_rc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-review&quot;</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_pd_data_sc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-wiki&quot;</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">load_edgelist_wiki</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-subreddit&quot;</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">load_edgelist_wiki</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tgbl-lastfm&quot;</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">load_edgelist_wiki</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-polecat&quot;</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_tkg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-icews&quot;</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_tkg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-yago&quot;</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_tkg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-wikidata&quot;</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_wikidata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">OUT_NODE_ID</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="n">node_ids</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;tkgl-smallpedia&quot;</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_wikidata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">OUT_NODE_ID</span><span class="p">)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span> <span class="o">=</span> <span class="n">node_ids</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-myket&quot;</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_thg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-github&quot;</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_thg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-forum&quot;</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_forum_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;thgl-software&quot;</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="n">csv_to_thg_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">edge_feat</span><span class="p">,</span> <span class="n">OUT_EDGE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="n">node_feat</span> <span class="o">=</span> <span class="n">process_node_feat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodefile&quot;</span><span class="p">],</span> <span class="n">node_ids</span><span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_feat</span><span class="p">,</span> <span class="n">OUT_NODE_FEAT</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="n">node_type</span> <span class="o">=</span> <span class="n">process_node_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;nodeTypeFile&quot;</span><span class="p">],</span> <span class="n">node_ids</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">node_type</span><span class="p">,</span> <span class="n">OUT_NODE_TYPE</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="c1">#? do not return node_type, simply set it</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_feat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.generate_splits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_splits</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">val_ratio</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">test_ratio</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generates train, validation, and test splits from the full dataset
Args:
    full_data: dictionary containing the full dataset
    val_ratio: ratio of validation data
    test_ratio: ratio of test data
Returns:
    train_data: dictionary containing the training dataset
    val_data: dictionary containing the validation dataset
    test_data: dictionary containing the test dataset</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="k">def</span> <span class="nf">generate_splits</span><span class="p">(</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="n">full_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="n">val_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="n">test_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generates train, validation, and test splits from the full dataset</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        full_data: dictionary containing the full dataset</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        val_ratio: ratio of validation data</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">        test_ratio: ratio of test data</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        train_data: dictionary containing the training dataset</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        val_data: dictionary containing the validation dataset</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">        test_data: dictionary containing the test dataset</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="n">val_time</span><span class="p">,</span> <span class="n">test_time</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">],</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="p">[(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">val_ratio</span> <span class="o">-</span> <span class="n">test_ratio</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">test_ratio</span><span class="p">)],</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">]</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="n">train_mask</span> <span class="o">=</span> <span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">val_time</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="n">val_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">test_time</span><span class="p">,</span> <span class="n">timestamps</span> <span class="o">&gt;</span> <span class="n">val_time</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="n">test_mask</span> <span class="o">=</span> <span class="n">timestamps</span> <span class="o">&gt;</span> <span class="n">test_time</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="k">return</span> <span class="n">train_mask</span><span class="p">,</span> <span class="n">val_mask</span><span class="p">,</span> <span class="n">test_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.load_test_ns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_test_ns</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>load the negative samples for the test set</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="k">def</span> <span class="nf">load_test_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    load the negative samples for the test set</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span><span class="o">.</span><span class="n">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;test_ns&quot;</span><span class="p">],</span> <span class="n">split_mode</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.load_val_ns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_val_ns</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>load the negative samples for the validation set</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="k">def</span> <span class="nf">load_val_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    load the negative samples for the validation set</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ns_sampler</span><span class="o">.</span><span class="n">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;val_ns&quot;</span><span class="p">],</span> <span class="n">split_mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.pre_process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pre_process</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Pre-process the dataset and generates the splits, must be run before dataset properties can be accessed
generates the edge data and different train, val, test splits</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="k">def</span> <span class="nf">pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    Pre-process the dataset and generates the splits, must be run before dataset properties can be accessed</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    generates the edge data and different train, val, test splits</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="c1"># check if path to file is valid</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="n">df</span><span class="p">,</span> <span class="n">edge_feat</span><span class="p">,</span> <span class="n">node_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_processed_files</span><span class="p">()</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="c1">#* design choice, only stores the original edges not the inverse relations on disc</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;tkgl&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">add_inverse_quadruples</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="n">sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">])</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="n">destinations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">])</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">])</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="n">edge_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">])</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">])</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="n">edge_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>  <span class="c1"># should be 1 for all pos edges</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span> <span class="o">=</span> <span class="n">edge_feat</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="n">node_feat</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">full_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="n">sources</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="n">destinations</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="s2">&quot;timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="s2">&quot;edge_idxs&quot;</span><span class="p">:</span> <span class="n">edge_idxs</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="s2">&quot;edge_feat&quot;</span><span class="p">:</span> <span class="n">edge_feat</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="n">weights</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="s2">&quot;edge_label&quot;</span><span class="p">:</span> <span class="n">edge_label</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="p">}</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="c1">#* for tkg and thg</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;edge_type&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="p">):</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="n">edge_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="n">edge_type</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_type</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">=</span> <span class="n">full_data</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;yago&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">_train_mask</span><span class="p">,</span> <span class="n">_val_mask</span><span class="p">,</span> <span class="n">_test_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_splits</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">val_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">test_ratio</span><span class="o">=</span><span class="mf">0.10</span><span class="p">)</span> <span class="c1">#99) #val_ratio=0.097, test_ratio=0.099)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">_train_mask</span><span class="p">,</span> <span class="n">_val_mask</span><span class="p">,</span> <span class="n">_test_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_splits</span><span class="p">(</span><span class="n">full_data</span><span class="p">,</span> <span class="n">val_ratio</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">test_ratio</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span> <span class="o">=</span> <span class="n">_train_mask</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span> <span class="o">=</span> <span class="n">_val_mask</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span> <span class="o">=</span> <span class="n">_test_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset.LinkPropPredDataset.preprocess_static_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_static_edges</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Pre-process the static edges of the dataset</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="k">def</span> <span class="nf">preprocess_static_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    Pre-process the static edges of the dataset</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;staticfile&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="n">OUT_DF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;ml_</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_static&quot;</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_passed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loading processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="n">static_dict</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="n">static_dict</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;file not processed, generating processed file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="n">static_dict</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span>  <span class="n">csv_to_staticdata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_dict</span><span class="p">[</span><span class="s2">&quot;staticfile&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_id</span><span class="p">)</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">static_dict</span><span class="p">,</span> <span class="n">OUT_DF</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="n">static_dict</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;static edges are only for tkgl-wikidata and tkgl-smallpedia datasets&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.dataset_pyg"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset" class="doc doc-heading">
            <code>PyGLinkPropPredDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch_geometric.data.Dataset">Dataset</span></code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="k">class</span> <span class="nc">PyGLinkPropPredDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="n">root</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="n">transform</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="n">pre_transform</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        PyG wrapper for the LinkPropPredDataset</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        can return pytorch tensors for src,dst,t,msg,label</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        can return Temporal Data object</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">            name: name of the dataset, passed to `LinkPropPredDataset`</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">            root (string): Root directory where the dataset should be saved, passed to `LinkPropPredDataset`</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">            transform (callable, optional): A function/transform that takes in an, not used in this case</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">            pre_transform (callable, optional): A function/transform that takes in, not used in this case</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">LinkPropPredDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">train_mask</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">val_mask</span><span class="p">)</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_mask</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">pre_transform</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_feat</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_type</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_type</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">process_data</span><span class="p">()</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ns_sampler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">negative_sampler</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">def</span> <span class="nf">eval_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        the official evaluation metric for the dataset, loaded from info.py</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            eval_metric: str, the evaluation metric</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">eval_metric</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">def</span> <span class="nf">negative_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NegativeEdgeSampler</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Returns the negative sampler of the dataset, will load negative samples from disc</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            negative_sampler: NegativeEdgeSampler</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ns_sampler</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">def</span> <span class="nf">num_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Returns the total number of unique nodes in the dataset </span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            num_nodes: int, the number of unique nodes</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">num_nodes</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">def</span> <span class="nf">num_rels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Returns the total number of unique relations in the dataset </span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            num_rels: int, the number of unique relations</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">num_rels</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">def</span> <span class="nf">num_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        Returns the total number of edges in the dataset </span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            num_edges: int, the number of edges</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">num_edges</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">def</span> <span class="nf">load_val_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        load the negative samples for the validation set</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">load_val_ns</span><span class="p">()</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">def</span> <span class="nf">load_test_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        load the negative samples for the test set</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">load_test_ns</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">def</span> <span class="nf">train_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        Returns the train mask of the dataset</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            train_mask: the mask for edges in the training set</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;training split hasn&#39;t been loaded&quot;</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">def</span> <span class="nf">val_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Returns the validation mask of the dataset</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">            val_mask: the mask for edges in the validation set</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;validation split hasn&#39;t been loaded&quot;</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">def</span> <span class="nf">test_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        Returns the test mask of the dataset:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            test_mask: the mask for edges in the test set</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;test split hasn&#39;t been loaded&quot;</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">def</span> <span class="nf">node_feat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        Returns the node features of the dataset</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            node_feat: the node features</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">def</span> <span class="nf">node_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Returns the node types of the dataset</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">            node_type: the node types [N]</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        Returns the source nodes of the dataset</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">            src: the idx of the source nodes</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">def</span> <span class="nf">dst</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        Returns the destination nodes of the dataset</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">            dst: the idx of the destination nodes</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dst</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span> <span class="nf">ts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Returns the timestamps of the dataset</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            ts: the timestamps of the edges</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">def</span> <span class="nf">static_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        Returns the static data of the dataset for tkgl-wikidata and tkgl-smallpedia</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">            static_data: the static data of the dataset</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">static_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">static_dict</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">static_data</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">static_dict</span><span class="p">[</span><span class="s2">&quot;tail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">static_data</span><span class="p">[</span><span class="s2">&quot;tail&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">static_dict</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">static_data</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="n">static_dict</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> 
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="k">def</span> <span class="nf">edge_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Returns the edge types for each edge</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">            edge_type: edge type tensor (int)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">def</span> <span class="nf">edge_feat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        Returns the edge features of the dataset</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">            edge_feat: the edge features</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">def</span> <span class="nf">edge_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        Returns the edge labels of the dataset</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">            edge_label: the labels of the edges</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        convert the numpy arrays from dataset to pytorch tensors</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">])</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">dst</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">])</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">])</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_feat&quot;</span><span class="p">]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="p">)</span>  <span class="c1"># use edge features here if available</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">edge_label</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_label&quot;</span><span class="p">]</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="p">)</span>  <span class="c1"># this is the label indicating if an edge is a true edge, always 1 for true edges</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="c1"># * first check typing for all tensors</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="c1"># source tensor must be of type int64</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="c1"># warnings.warn(&quot;sources tensor is not of type int64 or int32, forcing conversion&quot;)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">src</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="c1"># destination tensor must be of type int64</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="n">dst</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="c1"># timestamp tensor must be of type int64</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="c1"># message tensor must be of type float32</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="c1">#* for tkg</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;edge_type&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">edge_type</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">])</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="k">if</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="n">edge_type</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="n">src</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dst</span> <span class="o">=</span> <span class="n">dst</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span> <span class="o">=</span> <span class="n">ts</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span> <span class="o">=</span> <span class="n">edge_label</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span> <span class="o">=</span> <span class="n">msg</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="k">def</span> <span class="nf">get_TemporalData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TemporalData</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        return the TemporalData object for the entire dataset</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="n">edge_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        size of the dataset</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">            size: int</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TemporalData</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        construct temporal data object for a single edge</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">            idx: index of the edge</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">            data: TemporalData object</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                <span class="n">edge_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">()&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.dst" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dst</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the destination nodes of the dataset
Returns:
    dst: the idx of the destination nodes</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.edge_feat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_feat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the edge features of the dataset
Returns:
    edge_feat: the edge features</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.edge_label" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_label</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the edge labels of the dataset
Returns:
    edge_label: the labels of the edges</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.edge_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edge_type</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the edge types for each edge
Returns:
    edge_type: edge type tensor (int)</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.eval_metric" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_metric</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>the official evaluation metric for the dataset, loaded from info.py
Returns:
    eval_metric: str, the evaluation metric</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.negative_sampler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">negative_sampler</span><span class="p">:</span> <span class="n">NegativeEdgeSampler</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the negative sampler of the dataset, will load negative samples from disc
Returns:
    negative_sampler: NegativeEdgeSampler</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.node_feat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_feat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the node features of the dataset
Returns:
    node_feat: the node features</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.node_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_type</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the node types of the dataset
Returns:
    node_type: the node types [N]</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.num_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_edges</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the total number of edges in the dataset 
Returns:
    num_edges: int, the number of edges</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.num_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_nodes</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the total number of unique nodes in the dataset 
Returns:
    num_nodes: int, the number of unique nodes</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.num_rels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_rels</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the total number of unique relations in the dataset 
Returns:
    num_rels: int, the number of unique relations</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.src" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">src</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the source nodes of the dataset
Returns:
    src: the idx of the source nodes</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.static_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">static_data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the static data of the dataset for tkgl-wikidata and tkgl-smallpedia
Returns:
    static_data: the static data of the dataset</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.test_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the test mask of the dataset:
Returns:
    test_mask: the mask for edges in the test set</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.train_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the train mask of the dataset
Returns:
    train_mask: the mask for edges in the training set</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.ts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ts</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the timestamps of the dataset
Returns:
    ts: the timestamps of the edges</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.val_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">val_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Returns the validation mask of the dataset
Returns:
    val_mask: the mask for edges in the validation set</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pre_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>PyG wrapper for the LinkPropPredDataset
can return pytorch tensors for src,dst,t,msg,label
can return Temporal Data object
Parameters:
    name: name of the dataset, passed to <code>LinkPropPredDataset</code>
    root (string): Root directory where the dataset should be saved, passed to <code>LinkPropPredDataset</code>
    transform (callable, optional): A function/transform that takes in an, not used in this case
    pre_transform (callable, optional): A function/transform that takes in, not used in this case</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="n">root</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">transform</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">pre_transform</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    PyG wrapper for the LinkPropPredDataset</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    can return pytorch tensors for src,dst,t,msg,label</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    can return Temporal Data object</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        name: name of the dataset, passed to `LinkPropPredDataset`</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        root (string): Root directory where the dataset should be saved, passed to `LinkPropPredDataset`</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        transform (callable, optional): A function/transform that takes in an, not used in this case</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        pre_transform (callable, optional): A function/transform that takes in, not used in this case</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">LinkPropPredDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_train_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">train_mask</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_val_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">val_mask</span><span class="p">)</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_test_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_mask</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">pre_transform</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_feat</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_static_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_feat</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_type</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_node_type</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_type</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">process_data</span><span class="p">()</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ns_sampler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">negative_sampler</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>construct temporal data object for a single edge
Parameters:
    idx: index of the edge
Returns:
    data: TemporalData object</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TemporalData</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    construct temporal data object for a single edge</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        idx: index of the edge</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        data: TemporalData object</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="n">edge_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.get_TemporalData" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_TemporalData</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>return the TemporalData object for the entire dataset</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="k">def</span> <span class="nf">get_TemporalData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TemporalData</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    return the TemporalData object for the entire dataset</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="n">edge_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">TemporalData</span><span class="p">(</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dst</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.len" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">len</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>size of the dataset
Returns:
    size: int</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    size of the dataset</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        size: int</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.load_test_ns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_test_ns</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>load the negative samples for the test set</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span> <span class="nf">load_test_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    load the negative samples for the test set</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">load_test_ns</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.load_val_ns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_val_ns</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>load the negative samples for the validation set</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">def</span> <span class="nf">load_val_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    load the negative samples for the validation set</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">load_val_ns</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.dataset_pyg.PyGLinkPropPredDataset.process_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>convert the numpy arrays from dataset to pytorch tensors</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/dataset_pyg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    convert the numpy arrays from dataset to pytorch tensors</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="n">src</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">])</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="n">dst</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">])</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="n">ts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">])</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_feat&quot;</span><span class="p">]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="p">)</span>  <span class="c1"># use edge features here if available</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">edge_label</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_label&quot;</span><span class="p">]</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="p">)</span>  <span class="c1"># this is the label indicating if an edge is a true edge, always 1 for true edges</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="c1"># * first check typing for all tensors</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="c1"># source tensor must be of type int64</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1"># warnings.warn(&quot;sources tensor is not of type int64 or int32, forcing conversion&quot;)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="c1"># destination tensor must be of type int64</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">if</span> <span class="n">dst</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">dst</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="c1"># timestamp tensor must be of type int64</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="c1"># message tensor must be of type float32</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="c1">#* for tkg</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;edge_type&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">edge_type</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">full_data</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">])</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">if</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_type</span> <span class="o">=</span> <span class="n">edge_type</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="n">src</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_dst</span> <span class="o">=</span> <span class="n">dst</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span> <span class="o">=</span> <span class="n">ts</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_edge_label</span> <span class="o">=</span> <span class="n">edge_label</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_edge_feat</span> <span class="o">=</span> <span class="n">msg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.evaluate"></a>
    <div class="doc doc-contents first">

      <p>Evaluator Module for Dynamic Link Prediction</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.evaluate.Evaluator" class="doc doc-heading">
            <code>Evaluator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Evaluator for Link Property Prediction</p>

              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/evaluate.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">class</span> <span class="nc">Evaluator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Evaluator for Link Property Prediction &quot;&quot;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">            name: name of the dataset</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">            k_value: the desired &#39;k&#39; value for calculating metric@k</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k_value</span> <span class="o">=</span> <span class="n">k_value</span>  <span class="c1"># for computing `hits@k`</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valid_metric_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hits@&#39;</span><span class="p">,</span> <span class="s1">&#39;mrr&#39;</span><span class="p">]</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA_EVAL_METRIC_DICT</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Dataset not supported&quot;</span><span class="p">)</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">def</span> <span class="nf">_parse_and_check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        Check whether the input has the appropriate format</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Parametrers:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            input_dict: a dictionary containing &quot;y_pred_pos&quot;, &quot;y_pred_neg&quot;, and &quot;eval_metric&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            note: &quot;eval_metric&quot; should be a list including one or more of the followin metrics: [&quot;hits@&quot;, &quot;mrr&quot;]</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            y_pred_pos: positive predicted scores</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            y_pred_neg: negative predicted scores</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">if</span> <span class="s2">&quot;eval_metric&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Missing key of eval_metric!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">for</span> <span class="n">eval_metric</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;eval_metric&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="k">if</span> <span class="n">eval_metric</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_metric_list</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>                <span class="k">if</span> <span class="s2">&quot;y_pred_pos&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Missing key of y_true&quot;</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>                <span class="k">if</span> <span class="s2">&quot;y_pred_neg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Missing key of y_pred&quot;</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>                <span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">y_pred_neg</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;y_pred_pos&quot;</span><span class="p">],</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;y_pred_neg&quot;</span><span class="p">]</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>                <span class="c1"># converting to numpy on cpu</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>                <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>                    <span class="n">y_pred_pos</span> <span class="o">=</span> <span class="n">y_pred_pos</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>                <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_pred_neg</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>                    <span class="n">y_pred_neg</span> <span class="o">=</span> <span class="n">y_pred_neg</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="c1"># check type and shape</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_pred_neg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                        <span class="s2">&quot;Arguments to Evaluator need to be either numpy ndarray or torch tensor!&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                    <span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                    <span class="s2">&quot;ERROR: The evaluation metric should be in:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_metric_list</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                <span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported eval metric </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eval_metric</span><span class="p">))</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_metric</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;eval_metric&quot;</span><span class="p">]</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="k">return</span> <span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">y_pred_neg</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span> <span class="nf">_eval_hits_and_mrr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">y_pred_neg</span><span class="p">,</span> <span class="n">type_info</span><span class="p">,</span> <span class="n">k_value</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        compute hist@k and mrr</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        reference:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            - https://github.com/snap-stanford/ogb/blob/d5c11d91c9e1c22ed090a2e0bbda3fe357de66e7/ogb/linkproppred/evaluate.py#L214</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            y_pred_pos: positive predicted scores</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            y_pred_neg: negative predicted scores</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            type_info: type of the predicted scores; could be &#39;torch&#39; or &#39;numpy&#39;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            k_value: the desired &#39;k&#39; value for calculating metric@k</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            a dictionary containing the computed performance metrics</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">if</span> <span class="n">type_info</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="c1"># calculate ranks</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">y_pred_pos</span> <span class="o">=</span> <span class="n">y_pred_pos</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="c1"># optimistic rank: &quot;how many negatives have a larger score than the positive?&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="c1"># ~&gt; the positive is ranked first among those with equal score</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">optimistic_rank</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred_neg</span> <span class="o">&gt;</span> <span class="n">y_pred_pos</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="c1"># pessimistic rank: &quot;how many negatives have at least the positive score?&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="c1"># ~&gt; the positive is ranked last among those with equal score</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">pessimistic_rank</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred_neg</span> <span class="o">&gt;=</span> <span class="n">y_pred_pos</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">ranking_list</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">optimistic_rank</span> <span class="o">+</span> <span class="n">pessimistic_rank</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">hitsK_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">ranking_list</span> <span class="o">&lt;=</span> <span class="n">k_value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">mrr_list</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ranking_list</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                    <span class="sa">f</span><span class="s1">&#39;hits@</span><span class="si">{</span><span class="n">k_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">hitsK_list</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                    <span class="s1">&#39;mrr&#39;</span><span class="p">:</span> <span class="n">mrr_list</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                    <span class="p">}</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">y_pred_pos</span> <span class="o">=</span> <span class="n">y_pred_pos</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">optimistic_rank</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred_neg</span> <span class="o">&gt;</span> <span class="n">y_pred_pos</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="n">pessimistic_rank</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred_neg</span> <span class="o">&gt;=</span> <span class="n">y_pred_pos</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="n">ranking_list</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">optimistic_rank</span> <span class="o">+</span> <span class="n">pessimistic_rank</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">hitsK_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">ranking_list</span> <span class="o">&lt;=</span> <span class="n">k_value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="n">mrr_list</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ranking_list</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                    <span class="sa">f</span><span class="s1">&#39;hits@</span><span class="si">{</span><span class="n">k_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">hitsK_list</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                    <span class="s1">&#39;mrr&#39;</span><span class="p">:</span> <span class="n">mrr_list</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                    <span class="p">}</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>             <span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> 
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>             <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        evaluate the link prediction task</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        this method is callable through an instance of this object to compute the metric</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            input_dict: a dictionary containing &quot;y_pred_pos&quot;, &quot;y_pred_neg&quot;, and &quot;eval_metric&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">                        the performance metric is calculated for the provided scores</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            verbose: whether to print out the computed metric</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            perf_dict: a dictionary containing the computed performance metric</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">y_pred_neg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_and_check_input</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>  <span class="c1"># convert the predictions to numpy</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">perf_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_hits_and_mrr</span><span class="p">(</span><span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">y_pred_neg</span><span class="p">,</span> <span class="n">type_info</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="n">k_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_value</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">return</span> <span class="n">perf_dict</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.evaluate.Evaluator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">k_value</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>k_value</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the desired 'k' value for calculating metric@k</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/evaluate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        name: name of the dataset</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        k_value: the desired &#39;k&#39; value for calculating metric@k</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">k_value</span> <span class="o">=</span> <span class="n">k_value</span>  <span class="c1"># for computing `hits@k`</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">valid_metric_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hits@&#39;</span><span class="p">,</span> <span class="s1">&#39;mrr&#39;</span><span class="p">]</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DATA_EVAL_METRIC_DICT</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Dataset not supported&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.evaluate.Evaluator.eval" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>evaluate the link prediction task
this method is callable through an instance of this object to compute the metric</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input_dict</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary containing "y_pred_pos", "y_pred_neg", and "eval_metric"
        the performance metric is calculated for the provided scores</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to print out the computed metric</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>perf_dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary containing the computed performance metric</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/evaluate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>         <span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> 
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>         <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    evaluate the link prediction task</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    this method is callable through an instance of this object to compute the metric</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        input_dict: a dictionary containing &quot;y_pred_pos&quot;, &quot;y_pred_neg&quot;, and &quot;eval_metric&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">                    the performance metric is calculated for the provided scores</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        verbose: whether to print out the computed metric</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        perf_dict: a dictionary containing the computed performance metric</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">y_pred_neg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_and_check_input</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>  <span class="c1"># convert the predictions to numpy</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">perf_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_hits_and_mrr</span><span class="p">(</span><span class="n">y_pred_pos</span><span class="p">,</span> <span class="n">y_pred_neg</span><span class="p">,</span> <span class="n">type_info</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="n">k_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_value</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="n">perf_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.negative_sampler"></a>
    <div class="doc doc-contents first">

      <p>Sample negative edges for evaluation of dynamic link prediction
Load already generated negative edges from file, batch them based on the positive edge, and return the evaluation set</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.negative_sampler.NegativeEdgeSampler" class="doc doc-heading">
            <code>NegativeEdgeSampler</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/negative_sampler.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">class</span> <span class="nc">NegativeEdgeSampler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hist_rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        Negative Edge Sampler</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">            Loads and query the negative batches based on the positive batches provided.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        constructor for the negative edge sampler class</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            dataset_name: name of the dataset</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">            last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            strategy: will always load the pre-generated negatives</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            None</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="s2">&quot;rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="s2">&quot;hist_rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="p">],</span> <span class="s2">&quot;The supported strategies are `rnd` or `hist_rnd`!&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="k">def</span> <span class="nf">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        Load the evaluation set from disk, can be either val or test set ns samples</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            fname: the file name of the evaluation ns on disk</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            split_mode: the split mode of the evaluation set, can be either `val` or `test`</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            None</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">def</span> <span class="nf">reset_eval_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                       <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Reset evaluation set</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            None</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">def</span> <span class="nf">query_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                    <span class="n">pos_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> 
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                    <span class="n">pos_dst</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> 
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                    <span class="n">pos_timestamp</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> 
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                    <span class="n">edge_type</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                    <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        For each positive edge in the `pos_batch`, return a list of negative edges</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        `split_mode` specifies whether the valiation or test evaluation set should be retrieved.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        modify now to include edge type argument</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            pos_src: list of positive source nodes</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            pos_dst: list of positive destination nodes</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            pos_timestamp: list of timestamps of the positive edges</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            neg_samples: a list of list; each internal list contains the set of negative edges that</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">                        should be evaluated against each positive edge.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="sa">f</span><span class="s2">&quot;Evaluation set is None! You should load the </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2"> evaluation set first!&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="c1"># check the argument types...</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">pos_src</span> <span class="o">=</span> <span class="n">pos_src</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">pos_dst</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="n">pos_timestamp</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="s2">&quot;pos_src, pos_dst, and pos_timestamp need to be either numpy ndarray or torch tensor!&quot;</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">edge_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                        <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                    <span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                    <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                        <span class="p">[</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                            <span class="nb">int</span><span class="p">(</span><span class="n">neg_dst</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                            <span class="k">for</span> <span class="n">neg_dst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">][(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                        <span class="p">]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                    <span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                        <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                    <span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                    <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                        <span class="p">[</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                            <span class="nb">int</span><span class="p">(</span><span class="n">neg_dst</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                            <span class="k">for</span> <span class="n">neg_dst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">][(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                        <span class="p">]</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                    <span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">return</span> <span class="n">neg_samples</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_sampler.NegativeEdgeSampler.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">first_dst_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">last_dst_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;hist_rnd&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Negative Edge Sampler
    Loads and query the negative batches based on the positive batches provided.
constructor for the negative edge sampler class</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>first_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>identity of the first destination node</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>indentity of the last destination node</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>strategy</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>will always load the pre-generated negatives</p>
              </div>
            </td>
            <td>
                  <code>&#39;hist_rnd&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hist_rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Negative Edge Sampler</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        Loads and query the negative batches based on the positive batches provided.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    constructor for the negative edge sampler class</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        dataset_name: name of the dataset</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        strategy: will always load the pre-generated negatives</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        None</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="s2">&quot;rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="s2">&quot;hist_rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="p">],</span> <span class="s2">&quot;The supported strategies are `rnd` or `hist_rnd`!&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_sampler.NegativeEdgeSampler.load_eval_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_eval_set</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">split_mode</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load the evaluation set from disk, can be either val or test set ns samples
Parameters:
    fname: the file name of the evaluation ns on disk
    split_mode: the split mode of the evaluation set, can be either <code>val</code> or <code>test</code></p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="k">def</span> <span class="nf">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Load the evaluation set from disk, can be either val or test set ns samples</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        fname: the file name of the evaluation ns on disk</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        split_mode: the split mode of the evaluation set, can be either `val` or `test`</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        None</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_sampler.NegativeEdgeSampler.query_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query_batch</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">split_mode</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>For each positive edge in the <code>pos_batch</code>, return a list of negative edges
<code>split_mode</code> specifies whether the valiation or test evaluation set should be retrieved.
modify now to include edge type argument</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pos_src</code></td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of positive source nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pos_dst</code></td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of positive destination nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pos_timestamp</code></td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of timestamps of the positive edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                  <code>&#39;test&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>neg_samples</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of list; each internal list contains the set of negative edges that
        should be evaluated against each positive edge.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="k">def</span> <span class="nf">query_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="n">pos_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> 
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="n">pos_dst</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> 
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">pos_timestamp</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> 
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">edge_type</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    For each positive edge in the `pos_batch`, return a list of negative edges</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    `split_mode` specifies whether the valiation or test evaluation set should be retrieved.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    modify now to include edge type argument</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        pos_src: list of positive source nodes</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        pos_dst: list of positive destination nodes</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        pos_timestamp: list of timestamps of the positive edges</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        neg_samples: a list of list; each internal list contains the set of negative edges that</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">                    should be evaluated against each positive edge.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="sa">f</span><span class="s2">&quot;Evaluation set is None! You should load the </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2"> evaluation set first!&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="c1"># check the argument types...</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">pos_src</span> <span class="o">=</span> <span class="n">pos_src</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">pos_dst</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="n">pos_timestamp</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="s2">&quot;pos_src, pos_dst, and pos_timestamp need to be either numpy ndarray or torch tensor!&quot;</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">edge_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                    <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                    <span class="p">[</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">neg_dst</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                        <span class="k">for</span> <span class="n">neg_dst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">][(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                    <span class="p">]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                    <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="p">[</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">neg_dst</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                        <span class="k">for</span> <span class="n">neg_dst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">][(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                    <span class="p">]</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">return</span> <span class="n">neg_samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_sampler.NegativeEdgeSampler.reset_eval_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset_eval_set</span><span class="p">(</span><span class="n">split_mode</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Reset evaluation set</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                  <code>&#39;test&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span> <span class="nf">reset_eval_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                   <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Reset evaluation set</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        None</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.negative_generator"></a>
    <div class="doc doc-contents first">

      <p>Sample and Generate negative edges that are going to be used for evaluation of a dynamic graph learning model
Negative samples are generated and saved to files ONLY once; 
    other times, they should be loaded from file with instances of the <code>negative_sampler.py</code>.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.negative_generator.NegativeEdgeGenerator" class="doc doc-heading">
            <code>NegativeEdgeGenerator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/negative_generator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">class</span> <span class="nc">NegativeEdgeGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="n">num_neg_e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>  <span class="c1"># number of negative edges sampled per positive edges --&gt; make it constant =&gt; 1000</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">rnd_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">hist_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="n">historical_data</span><span class="p">:</span> <span class="n">TemporalData</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        Negative Edge Sampler class</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        this is a class for generating negative samples for a specific datasets</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        the set of the positive samples are provided, the negative samples are generated with specific strategies </span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        and are saved for consistent evaluation across different methods</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        negative edges are sampled with &#39;oen_vs_many&#39; strategy.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        it is assumed that the destination nodes are indexed sequentially with &#39;first_dst_id&#39; </span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        and &#39;last_dst_id&#39; being the first and last index, respectively.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            dataset_name: name of the dataset</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            num_neg_e: number of negative edges being generated per each positive edge</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            strategy: how to generate negative edges; can be &#39;rnd&#39; or &#39;hist_rnd&#39;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            rnd_seed: random seed for consistency</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            hist_ratio: if the startegy is &#39;hist_rnd&#39;, how much of the negatives are historical</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            historical_data: previous records of the positive edges</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            None</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span> <span class="o">=</span> <span class="n">rnd_seed</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span> <span class="o">=</span> <span class="n">first_dst_id</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">=</span> <span class="n">last_dst_id</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">=</span> <span class="n">num_neg_e</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="s2">&quot;rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="s2">&quot;hist_rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="p">],</span> <span class="s2">&quot;The supported strategies are `rnd` or `hist_rnd`!&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;hist_rnd&quot;</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="n">historical_data</span> <span class="o">!=</span> <span class="kc">None</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="p">),</span> <span class="s2">&quot;Train data should be passed when `hist_rnd` strategy is selected.&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hist_ratio</span> <span class="o">=</span> <span class="n">hist_ratio</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">historical_data</span> <span class="o">=</span> <span class="n">historical_data</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>                                  <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                                  <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Generate negative samples</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            partial_path: in which directory save the generated negatives</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="c1"># file name for saving or loading...</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">partial_path</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="o">+</span> <span class="n">split_mode</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="o">+</span> <span class="s2">&quot;ns&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;rnd&quot;</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_rnd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;hist_rnd&quot;</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_hist_rnd</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">historical_data</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported negative sample generation strategy!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples_rnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                                      <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                                      <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        Generate negative samples based on the `HIST-RND` strategy:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">            - for each positive edge, sample a batch of negative edges from all possible edges with the same source node</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            - filter actual positive edges</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">            filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="c1"># all possible destinations</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="n">t_mask</span> <span class="o">=</span> <span class="n">pos_timestamp</span> <span class="o">==</span> <span class="n">pos_t</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="n">src_mask</span> <span class="o">=</span> <span class="n">pos_src</span> <span class="o">==</span> <span class="n">pos_s</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">fn_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_mask</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="p">[</span><span class="n">fn_mask</span><span class="p">]</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">                when num_neg_e is larger than all possible destinations simple return all possible destinations</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">                &#39;&#39;&#39;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_dst</span><span class="p">)):</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                    <span class="n">filtered_all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">def</span> <span class="nf">generate_historical_edge_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                                     <span class="n">historical_data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Generate the set of edges seen durign training or validation</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        ONLY `train_data` should be passed as historical data; i.e., the HISTORICAL negative edges should be selected from training data only.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">            historical_data: contains the positive edges observed previously</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">            historical_edges: distict historical positive edges</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">            hist_edge_set_per_node: historical edges observed for each node</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">sources</span> <span class="o">=</span> <span class="n">historical_data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">destinations</span> <span class="o">=</span> <span class="n">historical_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">historical_edges</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">hist_e_per_node</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">destinations</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="c1"># edge-centric</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">historical_edges</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">historical_edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="c1"># node-centric</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hist_e_per_node</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="n">hist_e_per_node</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dst</span><span class="p">]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="n">hist_e_per_node</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">hist_edge_set_per_node</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst_list</span> <span class="ow">in</span> <span class="n">hist_e_per_node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">hist_edge_set_per_node</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dst_list</span><span class="p">)))</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">return</span> <span class="n">historical_edges</span><span class="p">,</span> <span class="n">hist_edge_set_per_node</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples_hist_rnd</span><span class="p">(</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">historical_data</span> <span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Generate negative samples based on the `HIST-RND` strategy:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">            - up to 50% of the negative samples are selected from the set of edges seen during the training with the same source node.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            - the rest of the negative edges are randomly sampled with the fixed source node.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            historical_data: contains the history of the observed positive edges including </span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">                            distinct positive edges and edges observed for each positive node</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">            filename: name of the file to save generated negative edges</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">            None</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">pos_ts_edge_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#{ts: {src: [dsts]}}</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pos_ts_edge_dict</span><span class="p">):</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                    <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_s</span><span class="p">:</span> <span class="p">[</span><span class="n">pos_d</span><span class="p">]}</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">pos_s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">]):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                        <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">][</span><span class="n">pos_s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos_d</span><span class="p">]</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                        <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">][</span><span class="n">pos_s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_d</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="c1"># all possible destinations</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="c1"># get seen edge history</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="n">historical_edges</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="n">hist_edge_set_per_node</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_historical_edge_set</span><span class="p">(</span><span class="n">historical_data</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="c1"># sample historical edges</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="n">max_num_hist_neg_e</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist_ratio</span><span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">][</span><span class="n">pos_s</span><span class="p">])</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                <span class="c1"># sample historical edges</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="n">num_hist_neg_e</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                <span class="n">neg_hist_dsts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">seen_dst</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="k">if</span> <span class="n">pos_s</span> <span class="ow">in</span> <span class="n">hist_edge_set_per_node</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                    <span class="n">seen_dst</span> <span class="o">=</span> <span class="n">hist_edge_set_per_node</span><span class="p">[</span><span class="n">pos_s</span><span class="p">]</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_dst</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                        <span class="n">filtered_all_seen_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">seen_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                        <span class="c1">#filtered_all_seen_dst = seen_dst #! no collision check</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                        <span class="n">num_hist_neg_e</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                            <span class="n">max_num_hist_neg_e</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                            <span class="k">if</span> <span class="n">max_num_hist_neg_e</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_seen_dst</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                            <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_seen_dst</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                        <span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                        <span class="n">neg_hist_dsts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                            <span class="n">filtered_all_seen_dst</span><span class="p">,</span> <span class="n">num_hist_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                        <span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="c1"># sample random edges</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seen_dst</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                    <span class="n">invalid_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos_e_dst_same_src</span><span class="p">),</span> <span class="n">seen_dst</span><span class="p">))</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                    <span class="n">invalid_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                <span class="n">filtered_all_rnd_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">invalid_dst</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="n">num_rnd_neg_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">-</span> <span class="n">num_hist_neg_e</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">                when num_neg_e is larger than all possible destinations simple return all possible destinations</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">                &#39;&#39;&#39;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">num_rnd_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_rnd_dst</span><span class="p">)):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                    <span class="n">neg_rnd_dsts</span> <span class="o">=</span> <span class="n">filtered_all_rnd_dst</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                    <span class="n">neg_rnd_dsts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                    <span class="n">filtered_all_rnd_dst</span><span class="p">,</span> <span class="n">num_rnd_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="c1"># concatenate the two sets: historical and random</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="n">neg_dst_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">neg_hist_dsts</span><span class="p">,</span> <span class="n">neg_rnd_dsts</span><span class="p">))</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_dst_arr</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_generator.NegativeEdgeGenerator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">first_dst_id</span><span class="p">,</span> <span class="n">last_dst_id</span><span class="p">,</span> <span class="n">num_neg_e</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;rnd&#39;</span><span class="p">,</span> <span class="n">rnd_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">hist_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">historical_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Negative Edge Sampler class
this is a class for generating negative samples for a specific datasets
the set of the positive samples are provided, the negative samples are generated with specific strategies 
and are saved for consistent evaluation across different methods
negative edges are sampled with 'oen_vs_many' strategy.
it is assumed that the destination nodes are indexed sequentially with 'first_dst_id' 
and 'last_dst_id' being the first and last index, respectively.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>first_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>identity of the first destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>indentity of the last destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>num_neg_e</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of negative edges being generated per each positive edge</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>strategy</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how to generate negative edges; can be 'rnd' or 'hist_rnd'</p>
              </div>
            </td>
            <td>
                  <code>&#39;rnd&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rnd_seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>random seed for consistency</p>
              </div>
            </td>
            <td>
                  <code>123</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hist_ratio</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the startegy is 'hist_rnd', how much of the negatives are historical</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>historical_data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>previous records of the positive edges</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">num_neg_e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>  <span class="c1"># number of negative edges sampled per positive edges --&gt; make it constant =&gt; 1000</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">rnd_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">hist_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">historical_data</span><span class="p">:</span> <span class="n">TemporalData</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Negative Edge Sampler class</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    this is a class for generating negative samples for a specific datasets</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    the set of the positive samples are provided, the negative samples are generated with specific strategies </span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    and are saved for consistent evaluation across different methods</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    negative edges are sampled with &#39;oen_vs_many&#39; strategy.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    it is assumed that the destination nodes are indexed sequentially with &#39;first_dst_id&#39; </span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    and &#39;last_dst_id&#39; being the first and last index, respectively.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        dataset_name: name of the dataset</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        num_neg_e: number of negative edges being generated per each positive edge</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        strategy: how to generate negative edges; can be &#39;rnd&#39; or &#39;hist_rnd&#39;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        rnd_seed: random seed for consistency</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        hist_ratio: if the startegy is &#39;hist_rnd&#39;, how much of the negatives are historical</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        historical_data: previous records of the positive edges</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        None</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span> <span class="o">=</span> <span class="n">rnd_seed</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span> <span class="o">=</span> <span class="n">first_dst_id</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">=</span> <span class="n">last_dst_id</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">=</span> <span class="n">num_neg_e</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="s2">&quot;rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="s2">&quot;hist_rnd&quot;</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="p">],</span> <span class="s2">&quot;The supported strategies are `rnd` or `hist_rnd`!&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;hist_rnd&quot;</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">historical_data</span> <span class="o">!=</span> <span class="kc">None</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="p">),</span> <span class="s2">&quot;Train data should be passed when `hist_rnd` strategy is selected.&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hist_ratio</span> <span class="o">=</span> <span class="n">hist_ratio</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">historical_data</span> <span class="o">=</span> <span class="n">historical_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_historical_edge_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_historical_edge_set</span><span class="p">(</span><span class="n">historical_data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate the set of edges seen durign training or validation</p>
<p>ONLY <code>train_data</code> should be passed as historical data; i.e., the HISTORICAL negative edges should be selected from training data only.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>historical_data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>contains the positive edges observed previously</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>historical_edges</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>distict historical positive edges</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>hist_edge_set_per_node</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>historical edges observed for each node</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="k">def</span> <span class="nf">generate_historical_edge_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                                 <span class="n">historical_data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Generate the set of edges seen durign training or validation</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    ONLY `train_data` should be passed as historical data; i.e., the HISTORICAL negative edges should be selected from training data only.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        historical_data: contains the positive edges observed previously</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        historical_edges: distict historical positive edges</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        hist_edge_set_per_node: historical edges observed for each node</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="n">sources</span> <span class="o">=</span> <span class="n">historical_data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">destinations</span> <span class="o">=</span> <span class="n">historical_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">historical_edges</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">hist_e_per_node</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">destinations</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="c1"># edge-centric</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">historical_edges</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">historical_edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="c1"># node-centric</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hist_e_per_node</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="n">hist_e_per_node</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dst</span><span class="p">]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="n">hist_e_per_node</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">hist_edge_set_per_node</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst_list</span> <span class="ow">in</span> <span class="n">hist_e_per_node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">hist_edge_set_per_node</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dst_list</span><span class="p">)))</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">return</span> <span class="n">historical_edges</span><span class="p">,</span> <span class="n">hist_edge_set_per_node</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_negative_samples" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate negative samples</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>partial_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>in which directory save the generated negatives</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span> <span class="nf">generate_negative_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>                              <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>                              <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                              <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                              <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Generate negative samples</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        partial_path: in which directory save the generated negatives</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="c1"># file name for saving or loading...</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">partial_path</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="o">+</span> <span class="n">split_mode</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="o">+</span> <span class="s2">&quot;ns&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;rnd&quot;</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_rnd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;hist_rnd&quot;</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_hist_rnd</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">historical_data</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported negative sample generation strategy!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_negative_samples_hist_rnd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples_hist_rnd</span><span class="p">(</span><span class="n">historical_data</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate negative samples based on the <code>HIST-RND</code> strategy:
    - up to 50% of the negative samples are selected from the set of edges seen during the training with the same source node.
    - the rest of the negative edges are randomly sampled with the fixed source node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>historical_data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>contains the history of the observed positive edges including 
            distinct positive edges and edges observed for each positive node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file to save generated negative edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="k">def</span> <span class="nf">generate_negative_samples_hist_rnd</span><span class="p">(</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">historical_data</span> <span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    Generate negative samples based on the `HIST-RND` strategy:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        - up to 50% of the negative samples are selected from the set of edges seen during the training with the same source node.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        - the rest of the negative edges are randomly sampled with the fixed source node.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        historical_data: contains the history of the observed positive edges including </span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">                        distinct positive edges and edges observed for each positive node</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        filename: name of the file to save generated negative edges</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        None</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">pos_ts_edge_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#{ts: {src: [dsts]}}</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pos_ts_edge_dict</span><span class="p">):</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_s</span><span class="p">:</span> <span class="p">[</span><span class="n">pos_d</span><span class="p">]}</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">]):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                    <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">][</span><span class="n">pos_s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos_d</span><span class="p">]</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                    <span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">][</span><span class="n">pos_s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_d</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="c1"># all possible destinations</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="c1"># get seen edge history</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">historical_edges</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">hist_edge_set_per_node</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_historical_edge_set</span><span class="p">(</span><span class="n">historical_data</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="c1"># sample historical edges</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">max_num_hist_neg_e</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist_ratio</span><span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos_ts_edge_dict</span><span class="p">[</span><span class="n">pos_t</span><span class="p">][</span><span class="n">pos_s</span><span class="p">])</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="c1"># sample historical edges</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">num_hist_neg_e</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="n">neg_hist_dsts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="n">seen_dst</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="k">if</span> <span class="n">pos_s</span> <span class="ow">in</span> <span class="n">hist_edge_set_per_node</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="n">seen_dst</span> <span class="o">=</span> <span class="n">hist_edge_set_per_node</span><span class="p">[</span><span class="n">pos_s</span><span class="p">]</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_dst</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                    <span class="n">filtered_all_seen_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">seen_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                    <span class="c1">#filtered_all_seen_dst = seen_dst #! no collision check</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                    <span class="n">num_hist_neg_e</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                        <span class="n">max_num_hist_neg_e</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                        <span class="k">if</span> <span class="n">max_num_hist_neg_e</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_seen_dst</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                        <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_seen_dst</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                    <span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                    <span class="n">neg_hist_dsts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                        <span class="n">filtered_all_seen_dst</span><span class="p">,</span> <span class="n">num_hist_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                    <span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="c1"># sample random edges</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seen_dst</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="n">invalid_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos_e_dst_same_src</span><span class="p">),</span> <span class="n">seen_dst</span><span class="p">))</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                <span class="n">invalid_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">filtered_all_rnd_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">invalid_dst</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">num_rnd_neg_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">-</span> <span class="n">num_hist_neg_e</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">            when num_neg_e is larger than all possible destinations simple return all possible destinations</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">            &#39;&#39;&#39;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">num_rnd_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_rnd_dst</span><span class="p">)):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="n">neg_rnd_dsts</span> <span class="o">=</span> <span class="n">filtered_all_rnd_dst</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                <span class="n">neg_rnd_dsts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="n">filtered_all_rnd_dst</span><span class="p">,</span> <span class="n">num_rnd_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="c1"># concatenate the two sets: historical and random</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">neg_dst_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">neg_hist_dsts</span><span class="p">,</span> <span class="n">neg_rnd_dsts</span><span class="p">))</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_dst_arr</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.negative_generator.NegativeEdgeGenerator.generate_negative_samples_rnd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples_rnd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate negative samples based on the <code>HIST-RND</code> strategy:
    - for each positive edge, sample a batch of negative edges from all possible edges with the same source node
    - filter actual positive edges</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file containing the generated negative edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="k">def</span> <span class="nf">generate_negative_samples_rnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                                  <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                                  <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    Generate negative samples based on the `HIST-RND` strategy:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        - for each positive edge, sample a batch of negative edges from all possible edges with the same source node</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        - filter actual positive edges</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="c1"># all possible destinations</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">t_mask</span> <span class="o">=</span> <span class="n">pos_timestamp</span> <span class="o">==</span> <span class="n">pos_t</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">src_mask</span> <span class="o">=</span> <span class="n">pos_src</span> <span class="o">==</span> <span class="n">pos_s</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">fn_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_mask</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="p">[</span><span class="n">fn_mask</span><span class="p">]</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">            when num_neg_e is larger than all possible destinations simple return all possible destinations</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">            &#39;&#39;&#39;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_dst</span><span class="p">)):</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">filtered_all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.tkg_negative_generator"></a>
    <div class="doc doc-contents first">

      <p>Sample and Generate negative edges that are going to be used for evaluation of a dynamic graph learning model
Negative samples are generated and saved to files ONLY once; 
    other times, they should be loaded from file with instances of the <code>negative_sampler.py</code>.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator" class="doc doc-heading">
            <code>TKGNegativeEdgeGenerator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/tkg_negative_generator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">class</span> <span class="nc">TKGNegativeEdgeGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="n">num_neg_e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># -1 means generate all possible negatives</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="n">rnd_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="n">edge_data</span><span class="p">:</span> <span class="n">TemporalData</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Negative Edge Generator class for Temporal Knowledge Graphs</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        constructor for the negative edge generator class</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            dataset_name: name of the dataset</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            num_neg_e: number of negative edges being generated per each positive edge</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            strategy: specifies which strategy should be used for generating the negatives</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            rnd_seed: random seed for reproducibility</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            edge_data: the positive edges to generate the negatives for, assuming sorted temporally</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            None</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span> <span class="o">=</span> <span class="n">rnd_seed</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span> <span class="o">=</span> <span class="n">first_dst_id</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">=</span> <span class="n">last_dst_id</span>      
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">=</span> <span class="n">num_neg_e</span>  <span class="c1">#-1 means generate all </span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="s2">&quot;time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="s2">&quot;random&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="p">],</span> <span class="s2">&quot;The supported strategies are `time-filtered`, dst-time-filtered, random&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="k">if</span> <span class="n">partial_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                    <span class="s2">&quot;The partial path to the directory where the dst_dict is stored is required&quot;</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict_name</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                    <span class="n">partial_path</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                    <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                    <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                    <span class="o">+</span> <span class="s2">&quot;dst_dict&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                    <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_dst_dict</span><span class="p">(</span><span class="n">edge_data</span><span class="o">=</span><span class="n">edge_data</span><span class="p">,</span> <span class="n">dst_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dst_dict_name</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span> <span class="o">=</span> <span class="n">edge_data</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">def</span> <span class="nf">generate_dst_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> <span class="n">dst_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        Generate a dictionary of destination nodes for each type of edge</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            edge_data: an object containing positive edges information</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            dst_name: name of the file to save the generated dictionary of destination nodes</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            dst_dict: a dictionary of destination nodes for each type of edge</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">min_dst_idx</span><span class="p">,</span> <span class="n">max_dst_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">edge_data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">edge_data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">edge_data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">dst_track_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {edge_type: {dst_1, dst_2, ..} }</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">if</span> <span class="n">edge_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dst_track_dict</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="n">dst_track_dict</span><span class="p">[</span><span class="n">edge_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">dst_track_dict</span><span class="p">[</span><span class="n">edge_type</span><span class="p">][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">dst_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">edge_type_size</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dst_track_dict</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dst_track_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">edge_type_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dst</span><span class="p">))</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">dst_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dst</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;destination candidates generated for all edge types &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dst_dict</span><span class="p">))</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">return</span> <span class="n">dst_dict</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                                  <span class="n">pos_edges</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                                  <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        Generate negative samples</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            pos_edges: positive edges to generate the negatives for</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            partial_path: in which directory save the generated negatives</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="c1"># file name for saving or loading...</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">partial_path</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="o">+</span> <span class="n">split_mode</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="o">+</span> <span class="s2">&quot;ns&quot;</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_ftr</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_dst</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_random</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported negative sample generation strategy!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples_ftr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                                      <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                                      <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        now we consider (s, d, t, edge_type) as a unique edge</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        Generate negative samples based on the random strategy:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">            - for each positive edge, sample a batch of negative edges from all possible edges with the same source node</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">            - filter actual positive edges at the same timestamp with the same edge type</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">            filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">edge_t_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {(t, u, edge_type): {v_1, v_2, ..} }</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="c1">#! iterate once to put all edges into a dictionary for reference</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                    <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                    <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">conflict_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="n">conflict_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;conflict sets for ns samples for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">conflict_dict</span><span class="p">),</span> <span class="s2">&quot; positive edges are generated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">conflict_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples_dst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                                      <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                                      <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        now we consider (s, d, t, edge_type) as a unique edge</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Generate negative samples based on the random strategy:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            - for each positive edge, sample a batch of negative edges from all possible edges with the same source node</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">            - filter actual positive edges at the same timestamp with the same edge type</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">            filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dst_dict is not generated!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">edge_t_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {(t, u, edge_type): {v_1, v_2, ..} }</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="c1">#! iterate once to put all edges into a dictionary for reference</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>                    <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                    <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">new_pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">min_dst_idx</span><span class="p">,</span> <span class="n">max_dst_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">new_pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="c1">#* generate based on # of ns samples</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                <span class="n">conflict_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">dst_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span><span class="p">[</span><span class="n">edge_type</span><span class="p">]</span>  <span class="c1">#dst_set contains conflict set</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="n">sample_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="n">filtered_dst_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">dst_set</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">)</span> <span class="c1">#more efficient</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="n">dst_sampled</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_dst_idx</span><span class="p">,</span> <span class="n">max_dst_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_dst_set</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">sample_num</span><span class="p">):</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                    <span class="c1">#* with collision check</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                    <span class="n">filtered_sample_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">filtered_dst_set</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                    <span class="n">dst_sampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">filtered_sample_set</span><span class="p">,</span> <span class="n">sample_num</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                    <span class="c1"># #* remove the conflict set from dst set</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                    <span class="n">dst_sampled</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_dst_set</span><span class="p">)]</span> <span class="o">=</span> <span class="n">filtered_dst_set</span><span class="p">[:]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                    <span class="c1"># dst_sampled = rng.choice(max_dst_idx+1, sample_num, replace=False)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                    <span class="n">dst_sampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">filtered_dst_set</span><span class="p">,</span> <span class="n">sample_num</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">dst_sampled</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sample_num</span><span class="p">):</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;I am the bug that Julia worries about&quot;</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;dst_sampled shape is &quot;</span><span class="p">,</span> <span class="n">dst_sampled</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                <span class="n">out_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dst_sampled</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;negative samples for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_dict</span><span class="p">),</span> <span class="s2">&quot; positive edges are generated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">out_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                                      <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                                      <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        generate random negative edges for ablation study</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">            filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">first_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">last_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="n">t_mask</span> <span class="o">=</span> <span class="n">pos_timestamp</span> <span class="o">==</span> <span class="n">pos_t</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                <span class="n">src_mask</span> <span class="o">=</span> <span class="n">pos_src</span> <span class="o">==</span> <span class="n">pos_s</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="n">fn_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_mask</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="p">[</span><span class="n">fn_mask</span><span class="p">]</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_dst</span><span class="p">)):</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                    <span class="n">filtered_all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">first_dst_id</span><span class="p">,</span> <span class="n">last_dst_id</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;time-filtered&#39;</span><span class="p">,</span> <span class="n">num_neg_e</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rnd_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">partial_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Negative Edge Generator class for Temporal Knowledge Graphs
constructor for the negative edge generator class</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>first_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>identity of the first destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>indentity of the last destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>num_neg_e</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of negative edges being generated per each positive edge</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>strategy</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies which strategy should be used for generating the negatives</p>
              </div>
            </td>
            <td>
                  <code>&#39;time-filtered&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rnd_seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>random seed for reproducibility</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>edge_data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the positive edges to generate the negatives for, assuming sorted temporally</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">num_neg_e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># -1 means generate all possible negatives</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">rnd_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">edge_data</span><span class="p">:</span> <span class="n">TemporalData</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Negative Edge Generator class for Temporal Knowledge Graphs</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    constructor for the negative edge generator class</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        dataset_name: name of the dataset</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        num_neg_e: number of negative edges being generated per each positive edge</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        strategy: specifies which strategy should be used for generating the negatives</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        rnd_seed: random seed for reproducibility</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        edge_data: the positive edges to generate the negatives for, assuming sorted temporally</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        None</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span> <span class="o">=</span> <span class="n">rnd_seed</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span> <span class="o">=</span> <span class="n">first_dst_id</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">=</span> <span class="n">last_dst_id</span>      
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">=</span> <span class="n">num_neg_e</span>  <span class="c1">#-1 means generate all </span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="s2">&quot;time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="s2">&quot;random&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="p">],</span> <span class="s2">&quot;The supported strategies are `time-filtered`, dst-time-filtered, random&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="n">partial_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="s2">&quot;The partial path to the directory where the dst_dict is stored is required&quot;</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict_name</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="n">partial_path</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="o">+</span> <span class="s2">&quot;dst_dict&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_dst_dict</span><span class="p">(</span><span class="n">edge_data</span><span class="o">=</span><span class="n">edge_data</span><span class="p">,</span> <span class="n">dst_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dst_dict_name</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span> <span class="o">=</span> <span class="n">edge_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_dst_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_dst_dict</span><span class="p">(</span><span class="n">edge_data</span><span class="p">,</span> <span class="n">dst_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate a dictionary of destination nodes for each type of edge</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>edge_data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dst_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file to save the generated dictionary of destination nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dst_dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary of destination nodes for each type of edge</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="k">def</span> <span class="nf">generate_dst_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> <span class="n">dst_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Generate a dictionary of destination nodes for each type of edge</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        edge_data: an object containing positive edges information</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        dst_name: name of the file to save the generated dictionary of destination nodes</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        dst_dict: a dictionary of destination nodes for each type of edge</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">min_dst_idx</span><span class="p">,</span> <span class="n">max_dst_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">edge_data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="n">edge_data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">edge_data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">dst_track_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {edge_type: {dst_1, dst_2, ..} }</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">if</span> <span class="n">edge_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dst_track_dict</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="n">dst_track_dict</span><span class="p">[</span><span class="n">edge_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">dst_track_dict</span><span class="p">[</span><span class="n">edge_type</span><span class="p">][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">dst_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">edge_type_size</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dst_track_dict</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dst_track_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">edge_type_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dst</span><span class="p">))</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">dst_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dst</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;destination candidates generated for all edge types &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dst_dict</span><span class="p">))</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">return</span> <span class="n">dst_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate negative samples</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pos_edges</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>positive edges to generate the negatives for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>partial_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>in which directory save the generated negatives</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="k">def</span> <span class="nf">generate_negative_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                              <span class="n">pos_edges</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                              <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                              <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                              <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Generate negative samples</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        pos_edges: positive edges to generate the negatives for</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        partial_path: in which directory save the generated negatives</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="c1"># file name for saving or loading...</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">partial_path</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="o">+</span> <span class="n">split_mode</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="o">+</span> <span class="s2">&quot;ns&quot;</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_ftr</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_dst</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_random</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported negative sample generation strategy!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples_dst" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples_dst</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>now we consider (s, d, t, edge_type) as a unique edge
Generate negative samples based on the random strategy:
    - for each positive edge, sample a batch of negative edges from all possible edges with the same source node
    - filter actual positive edges at the same timestamp with the same edge type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file containing the generated negative edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="k">def</span> <span class="nf">generate_negative_samples_dst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                                  <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                                  <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    now we consider (s, d, t, edge_type) as a unique edge</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Generate negative samples based on the random strategy:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        - for each positive edge, sample a batch of negative edges from all possible edges with the same source node</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        - filter actual positive edges at the same timestamp with the same edge type</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The dst_dict is not generated!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">edge_t_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {(t, u, edge_type): {v_1, v_2, ..} }</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="c1">#! iterate once to put all edges into a dictionary for reference</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>                <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="n">new_pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="n">min_dst_idx</span><span class="p">,</span> <span class="n">max_dst_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">new_pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="c1">#* generate based on # of ns samples</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="n">conflict_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="n">dst_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span><span class="p">[</span><span class="n">edge_type</span><span class="p">]</span>  <span class="c1">#dst_set contains conflict set</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="n">sample_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">filtered_dst_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">dst_set</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">)</span> <span class="c1">#more efficient</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">dst_sampled</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_dst_idx</span><span class="p">,</span> <span class="n">max_dst_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_dst_set</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">sample_num</span><span class="p">):</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="c1">#* with collision check</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="n">filtered_sample_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">filtered_dst_set</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="n">dst_sampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">filtered_sample_set</span><span class="p">,</span> <span class="n">sample_num</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="c1"># #* remove the conflict set from dst set</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">dst_sampled</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_dst_set</span><span class="p">)]</span> <span class="o">=</span> <span class="n">filtered_dst_set</span><span class="p">[:]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="c1"># dst_sampled = rng.choice(max_dst_idx+1, sample_num, replace=False)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="n">dst_sampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">filtered_dst_set</span><span class="p">,</span> <span class="n">sample_num</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">dst_sampled</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sample_num</span><span class="p">):</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;I am the bug that Julia worries about&quot;</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;dst_sampled shape is &quot;</span><span class="p">,</span> <span class="n">dst_sampled</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="n">out_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dst_sampled</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;negative samples for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_dict</span><span class="p">),</span> <span class="s2">&quot; positive edges are generated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">out_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples_ftr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples_ftr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>now we consider (s, d, t, edge_type) as a unique edge
Generate negative samples based on the random strategy:
    - for each positive edge, sample a batch of negative edges from all possible edges with the same source node
    - filter actual positive edges at the same timestamp with the same edge type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file containing the generated negative edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="k">def</span> <span class="nf">generate_negative_samples_ftr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                                  <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                                  <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    now we consider (s, d, t, edge_type) as a unique edge</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    Generate negative samples based on the random strategy:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        - for each positive edge, sample a batch of negative edges from all possible edges with the same source node</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        - filter actual positive edges at the same timestamp with the same edge type</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">edge_t_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {(t, u, edge_type): {v_1, v_2, ..} }</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="c1">#! iterate once to put all edges into a dictionary for reference</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">conflict_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="n">conflict_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;conflict sets for ns samples for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">conflict_dict</span><span class="p">),</span> <span class="s2">&quot; positive edges are generated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">conflict_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_generator.TKGNegativeEdgeGenerator.generate_negative_samples_random" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples_random</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>generate random negative edges for ablation study</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file containing the generated negative edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="k">def</span> <span class="nf">generate_negative_samples_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                                  <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                                  <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    generate random negative edges for ablation study</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">first_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="n">last_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="n">t_mask</span> <span class="o">=</span> <span class="n">pos_timestamp</span> <span class="o">==</span> <span class="n">pos_t</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">src_mask</span> <span class="o">=</span> <span class="n">pos_src</span> <span class="o">==</span> <span class="n">pos_s</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">fn_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_mask</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="p">[</span><span class="n">fn_mask</span><span class="p">]</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_dst</span><span class="p">)):</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                <span class="n">filtered_all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.tkg_negative_sampler"></a>
    <div class="doc doc-contents first">

      <p>Sample negative edges for evaluation of dynamic link prediction
Load already generated negative edges from file, batch them based on the positive edge, and return the evaluation set</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler" class="doc doc-heading">
            <code>TKGNegativeEdgeSampler</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/tkg_negative_sampler.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">class</span> <span class="nc">TKGNegativeEdgeSampler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PROJ_DIR</span> <span class="o">+</span> <span class="s2">&quot;/data/processed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Negative Edge Sampler</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">            Loads and query the negative batches based on the positive batches provided.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        constructor for the negative edge sampler class</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">            dataset_name: name of the dataset</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            strategy: will always load the pre-generated negatives</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            partial_path: the path to the directory where the negative edges are stored</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            None</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span> <span class="o">=</span> <span class="n">first_dst_id</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">=</span> <span class="n">last_dst_id</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">def</span> <span class="nf">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        Load the evaluation set from disk, can be either val or test set ns samples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            fname: the file name of the evaluation ns on disk</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            split_mode: the split mode of the evaluation set, can be either `val` or `test`</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            None</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">def</span> <span class="nf">query_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                    <span class="n">pos_src</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                    <span class="n">pos_dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                    <span class="n">pos_timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                    <span class="n">edge_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                    <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        For each positive edge in the `pos_batch`, return a list of negative edges</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        `split_mode` specifies whether the valiation or test evaluation set should be retrieved.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        modify now to include edge type argument</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            pos_src: list of positive source nodes</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            pos_dst: list of positive destination nodes</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            pos_timestamp: list of timestamps of the positive edges</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            neg_samples: list of numpy array; each array contains the set of negative edges that</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                        should be evaluated against each positive edge.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="sa">f</span><span class="s2">&quot;Evaluation set is None! You should load the </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2"> evaluation set first!&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="c1"># check the argument types...</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">pos_src</span> <span class="o">=</span> <span class="n">pos_src</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">pos_dst</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="n">pos_timestamp</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="s2">&quot;pos_src, pos_dst, and pos_timestamp need to be either numpy ndarray or torch tensor!&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                        <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                    <span class="n">conflict_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                    <span class="n">conflict_set</span> <span class="o">=</span> <span class="n">conflict_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                    <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                    <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                    <span class="c1">#! always using all possible destinations for evaluation</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                    <span class="c1">#! this is very slow</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                    <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                            <span class="n">neg_d_arr</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                        <span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                        <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                    <span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                    <span class="n">filtered_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_dst</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                    <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                            <span class="n">neg_d_arr</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                        <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="c1">#? can&#39;t convert to numpy array due to different lengths of negative samples</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">return</span> <span class="n">neg_samples</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">first_dst_id</span><span class="p">,</span> <span class="n">last_dst_id</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;time-filtered&#39;</span><span class="p">,</span> <span class="n">partial_path</span><span class="o">=</span><span class="n">PROJ_DIR</span> <span class="o">+</span> <span class="s1">&#39;/data/processed&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Negative Edge Sampler
    Loads and query the negative batches based on the positive batches provided.
constructor for the negative edge sampler class</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>first_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>identity of the first destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last_dst_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>indentity of the last destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>strategy</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>will always load the pre-generated negatives</p>
              </div>
            </td>
            <td>
                  <code>&#39;time-filtered&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>partial_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the path to the directory where the negative edges are stored</p>
              </div>
            </td>
            <td>
                  <code><span title="tgb.utils.info.PROJ_DIR">PROJ_DIR</span> + &#39;/data/processed&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">first_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">last_dst_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PROJ_DIR</span> <span class="o">+</span> <span class="s2">&quot;/data/processed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Negative Edge Sampler</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        Loads and query the negative batches based on the positive batches provided.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    constructor for the negative edge sampler class</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        dataset_name: name of the dataset</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        first_dst_id: identity of the first destination node</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        last_dst_id: indentity of the last destination node</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        strategy: will always load the pre-generated negatives</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        partial_path: the path to the directory where the negative edges are stored</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        None</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span> <span class="o">=</span> <span class="n">first_dst_id</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">=</span> <span class="n">last_dst_id</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dst_dict</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler.load_eval_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_eval_set</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">split_mode</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load the evaluation set from disk, can be either val or test set ns samples
Parameters:
    fname: the file name of the evaluation ns on disk
    split_mode: the split mode of the evaluation set, can be either <code>val</code> or <code>test</code></p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="k">def</span> <span class="nf">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Load the evaluation set from disk, can be either val or test set ns samples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        fname: the file name of the evaluation ns on disk</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        split_mode: the split mode of the evaluation set, can be either `val` or `test`</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        None</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.tkg_negative_sampler.TKGNegativeEdgeSampler.query_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query_batch</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">,</span> <span class="n">split_mode</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>For each positive edge in the <code>pos_batch</code>, return a list of negative edges
<code>split_mode</code> specifies whether the valiation or test evaluation set should be retrieved.
modify now to include edge type argument</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pos_src</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of positive source nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pos_dst</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of positive destination nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pos_timestamp</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of timestamps of the positive edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                  <code>&#39;test&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>neg_samples</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of numpy array; each array contains the set of negative edges that
        should be evaluated against each positive edge.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/tkg_negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span> <span class="nf">query_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="n">pos_src</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="n">pos_dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="n">pos_timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="n">edge_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    For each positive edge in the `pos_batch`, return a list of negative edges</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    `split_mode` specifies whether the valiation or test evaluation set should be retrieved.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    modify now to include edge type argument</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        pos_src: list of positive source nodes</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        pos_dst: list of positive destination nodes</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        pos_timestamp: list of timestamps of the positive edges</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        neg_samples: list of numpy array; each array contains the set of negative edges that</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                    should be evaluated against each positive edge.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="sa">f</span><span class="s2">&quot;Evaluation set is None! You should load the </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2"> evaluation set first!&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># check the argument types...</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">pos_src</span> <span class="o">=</span> <span class="n">pos_src</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">pos_dst</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="n">pos_timestamp</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="s2">&quot;pos_src, pos_dst, and pos_timestamp need to be either numpy ndarray or torch tensor!&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                    <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                <span class="n">conflict_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">conflict_set</span> <span class="o">=</span> <span class="n">conflict_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="c1">#! always using all possible destinations for evaluation</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="c1">#! this is very slow</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                        <span class="n">neg_d_arr</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                    <span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;dst-time-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                    <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">filtered_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_dst</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                        <span class="n">neg_d_arr</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                    <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="c1">#? can&#39;t convert to numpy array due to different lengths of negative samples</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">return</span> <span class="n">neg_samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.thg_negative_generator"></a>
    <div class="doc doc-contents first">

      <p>Sample and Generate negative edges that are going to be used for evaluation of a dynamic graph learning model
Negative samples are generated and saved to files ONLY once; 
    other times, they should be loaded from file with instances of the <code>negative_sampler.py</code>.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator" class="doc doc-heading">
            <code>THGNegativeEdgeGenerator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/thg_negative_generator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span> <span class="nc">THGNegativeEdgeGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">first_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="n">last_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="n">node_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="n">num_neg_e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># -1 means generate all possible negatives</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="n">rnd_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="n">edge_data</span><span class="p">:</span> <span class="n">TemporalData</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        Negative Edge Generator class for Temporal Heterogeneous Graphs</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        this is a class for generating negative samples for a specific datasets</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        the set of the positive samples are provided, the negative samples are generated with specific strategies </span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        and are saved for consistent evaluation across different methods</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            dataset_name: name of the dataset</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            first_node_id: the first node id</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            last_node_id: the last node id</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            node_type: the node type of each node</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            strategy: the strategy to generate negative samples</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            num_neg_e: number of negative samples to generate</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            rnd_seed: random seed</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            edge_data: the edge data object containing the positive edges</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            None</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span> <span class="o">=</span> <span class="n">rnd_seed</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_node_id</span> <span class="o">=</span> <span class="n">first_node_id</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_node_id</span> <span class="o">=</span> <span class="n">last_node_id</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="n">node_type</span> <span class="o">=</span> <span class="n">node_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_type_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_destinations_based_on_node_type</span><span class="p">(</span><span class="n">first_node_id</span><span class="p">,</span> <span class="n">last_node_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">)</span> <span class="c1"># {node_type: {nid:1}}</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;node_type should be a numpy array&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">=</span> <span class="n">num_neg_e</span>  <span class="c1">#-1 means generate all </span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="s2">&quot;random&quot;</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="p">],</span> <span class="s2">&quot;The supported strategies are `node-type-filtered`&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span> <span class="o">=</span> <span class="n">edge_data</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">def</span> <span class="nf">get_destinations_based_on_node_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                                            <span class="n">first_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                                            <span class="n">last_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                                            <span class="n">node_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        get the destination node id arrays based on the node type</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            first_node_id: the first node id</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            last_node_id: the last node id</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            node_type: the node type of each node</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            node_type_dict: a dictionary containing the destination node ids for each node type</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">node_type_store</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="k">assert</span> <span class="n">first_node_id</span> <span class="o">&lt;=</span> <span class="n">last_node_id</span><span class="p">,</span> <span class="s2">&quot;Invalid destination node ids!&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_type</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">last_node_id</span> <span class="o">-</span> <span class="n">first_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;node type array must match the indices&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_type</span><span class="p">)):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">node_type</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="c1">#node type must be ints</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">nid</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">first_node_id</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">if</span> <span class="n">nt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_type_store</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">node_type_store</span><span class="p">[</span><span class="n">nt</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nid</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">node_type_store</span><span class="p">[</span><span class="n">nt</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="n">node_type_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">for</span> <span class="n">ntype</span> <span class="ow">in</span> <span class="n">node_type_store</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">node_type_dict</span><span class="p">[</span><span class="n">ntype</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">node_type_store</span><span class="p">[</span><span class="n">ntype</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">node_type_dict</span><span class="p">[</span><span class="n">ntype</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Destination node ids for a given type must be sorted&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">node_type_dict</span><span class="p">[</span><span class="n">ntype</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">last_node_id</span><span class="p">),</span> <span class="s2">&quot;Destination node ids must be less than or equal to the last destination id&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">return</span> <span class="n">node_type_dict</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                                  <span class="n">pos_edges</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                                  <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        Generate negative samples</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">            pos_edges: positive edges to generate the negatives for</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            partial_path: in which directory save the generated negatives</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="c1"># file name for saving or loading...</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">partial_path</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="o">+</span> <span class="n">split_mode</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="o">+</span> <span class="s2">&quot;ns&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_nt</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_random</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported negative sample generation strategy!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples_nt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                                      <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                                      <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        now we consider (s, d, t, edge_type) as a unique edge, also adding the node type info for the destination node for convenience so (s, d, t, edge_type): (conflict_set, d_node_type)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Generate negative samples based on the random strategy:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            - for each positive edge, retrieve all possible destinations based on the node type of the destination node</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">            - filter actual positive edges at the same timestamp with the same edge type</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">edge_t_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {(t, u, edge_type): {v_1, v_2, ..} }</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="c1">#! iterate once to put all edges into a dictionary for reference</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                    <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                    <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="n">conflict_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="n">pos_d</span> <span class="o">=</span> <span class="n">conflict_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="c1">#* retieve the node type of the destination node as well </span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="c1">#! assumption, same edge type = same destination node type</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="n">d_node_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">[</span><span class="n">pos_d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node_id</span><span class="p">])</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="n">all_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type_dict</span><span class="p">[</span><span class="n">d_node_type</span><span class="p">]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                    <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                    <span class="c1">#* lazy sampling</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                        <span class="n">all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">neg_d_arr</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                        <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                            <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                    <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">out_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;ns samples for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_dict</span><span class="p">),</span> <span class="s2">&quot; positive edges are generated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">out_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">def</span> <span class="nf">generate_negative_samples_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                                      <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                                      <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        generate random negative edges for ablation study</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">            data: an object containing positive edges information</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">            filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">first_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">last_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="n">t_mask</span> <span class="o">=</span> <span class="n">pos_timestamp</span> <span class="o">==</span> <span class="n">pos_t</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="n">src_mask</span> <span class="o">=</span> <span class="n">pos_src</span> <span class="o">==</span> <span class="n">pos_s</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="n">fn_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_mask</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="p">[</span><span class="n">fn_mask</span><span class="p">]</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_dst</span><span class="p">)):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                    <span class="n">filtered_all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">first_node_id</span><span class="p">,</span> <span class="n">last_node_id</span><span class="p">,</span> <span class="n">node_type</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;node-type-filtered&#39;</span><span class="p">,</span> <span class="n">num_neg_e</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rnd_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edge_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Negative Edge Generator class for Temporal Heterogeneous Graphs
this is a class for generating negative samples for a specific datasets
the set of the positive samples are provided, the negative samples are generated with specific strategies 
and are saved for consistent evaluation across different methods</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>first_node_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the first node id</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last_node_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the last node id</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>node_type</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the node type of each node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>strategy</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the strategy to generate negative samples</p>
              </div>
            </td>
            <td>
                  <code>&#39;node-type-filtered&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>num_neg_e</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of negative samples to generate</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rnd_seed</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>random seed</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>edge_data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the edge data object containing the positive edges</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns:
    None</p>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">first_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">last_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">node_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">num_neg_e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># -1 means generate all possible negatives</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">rnd_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">edge_data</span><span class="p">:</span> <span class="n">TemporalData</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    Negative Edge Generator class for Temporal Heterogeneous Graphs</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    this is a class for generating negative samples for a specific datasets</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    the set of the positive samples are provided, the negative samples are generated with specific strategies </span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    and are saved for consistent evaluation across different methods</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        dataset_name: name of the dataset</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        first_node_id: the first node id</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        last_node_id: the last node id</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        node_type: the node type of each node</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        strategy: the strategy to generate negative samples</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        num_neg_e: number of negative samples to generate</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        rnd_seed: random seed</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        edge_data: the edge data object containing the positive edges</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        None</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span> <span class="o">=</span> <span class="n">rnd_seed</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd_seed</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_node_id</span> <span class="o">=</span> <span class="n">first_node_id</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_node_id</span> <span class="o">=</span> <span class="n">last_node_id</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">node_type</span> <span class="o">=</span> <span class="n">node_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">node_type_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_destinations_based_on_node_type</span><span class="p">(</span><span class="n">first_node_id</span><span class="p">,</span> <span class="n">last_node_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">)</span> <span class="c1"># {node_type: {nid:1}}</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;node_type should be a numpy array&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">=</span> <span class="n">num_neg_e</span>  <span class="c1">#-1 means generate all </span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">assert</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="s2">&quot;random&quot;</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="p">],</span> <span class="s2">&quot;The supported strategies are `node-type-filtered`&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span> <span class="o">=</span> <span class="n">edge_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.generate_negative_samples" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate negative samples</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pos_edges</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>positive edges to generate the negatives for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>partial_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>in which directory save the generated negatives</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">def</span> <span class="nf">generate_negative_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                              <span class="n">pos_edges</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                              <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                              <span class="n">partial_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                              <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Generate negative samples</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        pos_edges: positive edges to generate the negatives for</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        partial_path: in which directory save the generated negatives</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="c1"># file name for saving or loading...</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">partial_path</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="o">+</span> <span class="n">split_mode</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="o">+</span> <span class="s2">&quot;ns&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_nt</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_negative_samples_random</span><span class="p">(</span><span class="n">pos_edges</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported negative sample generation strategy!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.generate_negative_samples_nt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples_nt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>now we consider (s, d, t, edge_type) as a unique edge, also adding the node type info for the destination node for convenience so (s, d, t, edge_type): (conflict_set, d_node_type)
Generate negative samples based on the random strategy:
    - for each positive edge, retrieve all possible destinations based on the node type of the destination node
    - filter actual positive edges at the same timestamp with the same edge type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file containing the generated negative edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="k">def</span> <span class="nf">generate_negative_samples_nt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                                  <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                                  <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    now we consider (s, d, t, edge_type) as a unique edge, also adding the node type info for the destination node for convenience so (s, d, t, edge_type): (conflict_set, d_node_type)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Generate negative samples based on the random strategy:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        - for each positive edge, retrieve all possible destinations based on the node type of the destination node</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        - filter actual positive edges at the same timestamp with the same edge type</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">edge_t_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {(t, u, edge_type): {v_1, v_2, ..} }</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="c1">#! iterate once to put all edges into a dictionary for reference</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edge_t_dict</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">pos_d</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="n">edge_t_dict</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)][</span><span class="n">pos_d</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">conflict_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_t_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">pos_d</span> <span class="o">=</span> <span class="n">conflict_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="c1">#* retieve the node type of the destination node as well </span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="c1">#! assumption, same edge type = same destination node type</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">d_node_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">[</span><span class="n">pos_d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node_id</span><span class="p">])</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">all_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type_dict</span><span class="p">[</span><span class="n">d_node_type</span><span class="p">]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="c1">#* lazy sampling</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                    <span class="n">all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">neg_d_arr</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                    <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">conflict_set</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">out_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;ns samples for &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_dict</span><span class="p">),</span> <span class="s2">&quot; positive edges are generated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="c1"># save the generated evaluation set to disk</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">out_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.generate_negative_samples_random" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_negative_samples_random</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">split_mode</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>generate random negative edges for ablation study</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code><span title="torch_geometric.data.TemporalData">TemporalData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object containing positive edges information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file containing the generated negative edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="k">def</span> <span class="nf">generate_negative_samples_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                                  <span class="n">data</span><span class="p">:</span> <span class="n">TemporalData</span><span class="p">,</span> 
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                                  <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                                  <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    generate random negative edges for ablation study</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        data: an object containing positive edges information</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        filename: name of the file containing the generated negative edges</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="sa">f</span><span class="s2">&quot;INFO: Negative Sampling Strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="si">}</span><span class="s2">, Data Split: </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val` or `test`!&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="sa">f</span><span class="s2">&quot;INFO: negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation are already generated!&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO: Generating negative samples for &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="c1"># retrieve the information from the batch</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">data</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="n">data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="n">data</span><span class="o">.</span><span class="n">edge_type</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">first_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">last_dst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">first_dst_id</span><span class="p">,</span> <span class="n">last_dst_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">evaluation_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="c1"># generate a list of negative destinations for each positive edge</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">pos_edge_tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_src</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">for</span> <span class="p">(</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="n">pos_s</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="n">pos_d</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">pos_t</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">edge_type</span><span class="p">,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">pos_edge_tqdm</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="n">t_mask</span> <span class="o">=</span> <span class="n">pos_timestamp</span> <span class="o">==</span> <span class="n">pos_t</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">src_mask</span> <span class="o">=</span> <span class="n">pos_src</span> <span class="o">==</span> <span class="n">pos_s</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="n">fn_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">t_mask</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="n">pos_e_dst_same_src</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="p">[</span><span class="n">fn_mask</span><span class="p">]</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">filtered_all_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">all_dst</span><span class="p">,</span> <span class="n">pos_e_dst_same_src</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_all_dst</span><span class="p">)):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_all_dst</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="n">filtered_all_dst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_neg_e</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#never replace negatives</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="n">evaluation_set</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neg_d_arr</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">save_pkl</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_generator.THGNegativeEdgeGenerator.get_destinations_based_on_node_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_destinations_based_on_node_type</span><span class="p">(</span><span class="n">first_node_id</span><span class="p">,</span> <span class="n">last_node_id</span><span class="p">,</span> <span class="n">node_type</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>get the destination node id arrays based on the node type
Parameters:
    first_node_id: the first node id
    last_node_id: the last node id
    node_type: the node type of each node</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>node_type_dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary containing the destination node ids for each node type</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span> <span class="nf">get_destinations_based_on_node_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                                        <span class="n">first_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                                        <span class="n">last_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                                        <span class="n">node_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    get the destination node id arrays based on the node type</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        first_node_id: the first node id</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        last_node_id: the last node id</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        node_type: the node type of each node</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        node_type_dict: a dictionary containing the destination node ids for each node type</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">node_type_store</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">assert</span> <span class="n">first_node_id</span> <span class="o">&lt;=</span> <span class="n">last_node_id</span><span class="p">,</span> <span class="s2">&quot;Invalid destination node ids!&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_type</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">last_node_id</span> <span class="o">-</span> <span class="n">first_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;node type array must match the indices&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_type</span><span class="p">)):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">node_type</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="c1">#node type must be ints</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">nid</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">first_node_id</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">if</span> <span class="n">nt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_type_store</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">node_type_store</span><span class="p">[</span><span class="n">nt</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nid</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">node_type_store</span><span class="p">[</span><span class="n">nt</span><span class="p">][</span><span class="n">nid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">node_type_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">for</span> <span class="n">ntype</span> <span class="ow">in</span> <span class="n">node_type_store</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">node_type_dict</span><span class="p">[</span><span class="n">ntype</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">node_type_store</span><span class="p">[</span><span class="n">ntype</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">node_type_dict</span><span class="p">[</span><span class="n">ntype</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Destination node ids for a given type must be sorted&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">node_type_dict</span><span class="p">[</span><span class="n">ntype</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">last_node_id</span><span class="p">),</span> <span class="s2">&quot;Destination node ids must be less than or equal to the last destination id&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">return</span> <span class="n">node_type_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="tgb.linkproppred.thg_negative_sampler"></a>
    <div class="doc doc-contents first">

      <p>Sample negative edges for evaluation of dynamic link prediction
Load already generated negative edges from file, batch them based on the positive edge, and return the evaluation set</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler" class="doc doc-heading">
            <code>THGNegativeEdgeSampler</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>tgb/linkproppred/thg_negative_sampler.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">class</span> <span class="nc">THGNegativeEdgeSampler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">first_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">last_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">node_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Negative Edge Sampler</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">            Loads and query the negative batches based on the positive batches provided.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            constructor for the negative edge sampler class</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">            dataset_name: name of the dataset</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            first_node_id: identity of the first node</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            last_node_id: indentity of the last destination node</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            node_type: the node type of each node</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            strategy: will always load the pre-generated negatives</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            None</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_node_id</span> <span class="o">=</span> <span class="n">first_node_id</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_node_id</span> <span class="o">=</span> <span class="n">last_node_id</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;node_type should be a numpy array&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">def</span> <span class="nf">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        Load the evaluation set from disk, can be either val or test set ns samples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            fname: the file name of the evaluation ns on disk</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            split_mode: the split mode of the evaluation set, can be either `val` or `test`</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            None</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">def</span> <span class="nf">query_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                    <span class="n">pos_src</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                    <span class="n">pos_dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                    <span class="n">pos_timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                    <span class="n">edge_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                    <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        For each positive edge in the `pos_batch`, return a list of negative edges</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        `split_mode` specifies whether the valiation or test evaluation set should be retrieved.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        modify now to include edge type argument</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            pos_src: list of positive source nodes</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            pos_dst: list of positive destination nodes</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            pos_timestamp: list of timestamps of the positive edges</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            neg_samples: list of numpy array; each array contains the set of negative edges that</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                        should be evaluated against each positive edge.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="sa">f</span><span class="s2">&quot;Evaluation set is None! You should load the </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2"> evaluation set first!&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="c1"># check the argument types...</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">pos_src</span> <span class="o">=</span> <span class="n">pos_src</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">pos_dst</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="n">pos_timestamp</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="s2">&quot;pos_src, pos_dst, and pos_timestamp need to be either numpy ndarray or torch tensor!&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                    <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="n">filtered_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_dst</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                        <span class="n">neg_d_arr</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                    <span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="c1">#? can&#39;t convert to numpy array due to different lengths of negative samples</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">return</span> <span class="n">neg_samples</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">first_node_id</span><span class="p">,</span> <span class="n">last_node_id</span><span class="p">,</span> <span class="n">node_type</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;node-type-filtered&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Negative Edge Sampler
    Loads and query the negative batches based on the positive batches provided.
    constructor for the negative edge sampler class</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dataset_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>first_node_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>identity of the first node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last_node_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>indentity of the last destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>node_type</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the node type of each node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>strategy</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>will always load the pre-generated negatives</p>
              </div>
            </td>
            <td>
                  <code>&#39;node-type-filtered&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">first_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">last_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">node_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;node-type-filtered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Negative Edge Sampler</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        Loads and query the negative batches based on the positive batches provided.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        constructor for the negative edge sampler class</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        dataset_name: name of the dataset</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        first_node_id: identity of the first node</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        last_node_id: indentity of the last destination node</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        node_type: the node type of each node</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        strategy: will always load the pre-generated negatives</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        None</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_node_id</span> <span class="o">=</span> <span class="n">first_node_id</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_node_id</span> <span class="o">=</span> <span class="n">last_node_id</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span> <span class="o">=</span> <span class="n">node_type</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;node_type should be a numpy array&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler.load_eval_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_eval_set</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">split_mode</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load the evaluation set from disk, can be either val or test set ns samples
Parameters:
    fname: the file name of the evaluation ns on disk
    split_mode: the split mode of the evaluation set, can be either <code>val</code> or <code>test</code></p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="k">def</span> <span class="nf">load_eval_set</span><span class="p">(</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Load the evaluation set from disk, can be either val or test set ns samples</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        fname: the file name of the evaluation ns on disk</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        split_mode: the split mode of the evaluation set, can be either `val` or `test`</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        None</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found at </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_pkl</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tgb.linkproppred.thg_negative_sampler.THGNegativeEdgeSampler.query_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query_batch</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">,</span> <span class="n">split_mode</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>For each positive edge in the <code>pos_batch</code>, return a list of negative edges
<code>split_mode</code> specifies whether the valiation or test evaluation set should be retrieved.
modify now to include edge type argument</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pos_src</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of positive source nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pos_dst</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of positive destination nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pos_timestamp</code></td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of timestamps of the positive edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether to generate negative edges for 'validation' or 'test' splits</p>
              </div>
            </td>
            <td>
                  <code>&#39;test&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>neg_samples</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of numpy array; each array contains the set of negative edges that
        should be evaluated against each positive edge.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tgb/linkproppred/thg_negative_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span> <span class="nf">query_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="n">pos_src</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="n">pos_dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="n">pos_timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> 
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="n">edge_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="n">split_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    For each positive edge in the `pos_batch`, return a list of negative edges</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    `split_mode` specifies whether the valiation or test evaluation set should be retrieved.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    modify now to include edge type argument</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        pos_src: list of positive source nodes</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        pos_dst: list of positive destination nodes</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        pos_timestamp: list of timestamps of the positive edges</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        split_mode: specifies whether to generate negative edges for &#39;validation&#39; or &#39;test&#39; splits</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        neg_samples: list of numpy array; each array contains the set of negative edges that</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                    should be evaluated against each positive edge.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">assert</span> <span class="n">split_mode</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="s2">&quot;val&quot;</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="s2">&quot;test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="p">],</span> <span class="s2">&quot;Invalid split-mode! It should be `val`, `test`!&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="sa">f</span><span class="s2">&quot;Evaluation set is None! You should load the </span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2"> evaluation set first!&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># check the argument types...</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">pos_src</span> <span class="o">=</span> <span class="n">pos_src</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">pos_dst</span> <span class="o">=</span> <span class="n">pos_dst</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">pos_timestamp</span> <span class="o">=</span> <span class="n">pos_timestamp</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">if</span> <span class="n">torch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">edge_type</span> <span class="o">=</span> <span class="n">edge_type</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos_dst</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="s2">&quot;pos_src, pos_dst, and pos_timestamp need to be either numpy ndarray or torch tensor!&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">neg_samples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">for</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">,</span> <span class="n">pos_t</span><span class="p">,</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_src</span><span class="p">,</span> <span class="n">pos_dst</span><span class="p">,</span> <span class="n">pos_timestamp</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">):</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="sa">f</span><span class="s2">&quot;The edge (</span><span class="si">{</span><span class="n">pos_s</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pos_t</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">e_type</span><span class="si">}</span><span class="s2">) is not in the &#39;</span><span class="si">{</span><span class="n">split_mode</span><span class="si">}</span><span class="s2">&#39; evaluation set! Please check the implementation.&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">filtered_dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_set</span><span class="p">[</span><span class="n">split_mode</span><span class="p">]</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">neg_d_arr</span> <span class="o">=</span> <span class="n">filtered_dst</span><span class="p">[(</span><span class="n">pos_t</span><span class="p">,</span> <span class="n">pos_s</span><span class="p">,</span> <span class="n">e_type</span><span class="p">)]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">neg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                    <span class="n">neg_d_arr</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1">#? can&#39;t convert to numpy array due to different lengths of negative samples</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">return</span> <span class="n">neg_samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/shenyangHuang/TGB" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="shenyang.huang@mail.mcgill.ca" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/shenyangHuang" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/shenyang-huang/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>